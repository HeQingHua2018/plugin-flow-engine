"use strict";(self.webpackChunk_plugin_flow_engine_doc=self.webpackChunk_plugin_flow_engine_doc||[]).push([[257],{59820:function(ht,Ee,E){E.r(Ee),E.d(Ee,{BaseNodePlugin:function(){return ve},BuiltInPluginNodeTypes:function(){return P.FR},ComponentManagerInstance:function(){return dt},IterationMode:function(){return P.jc},ParallelStrategy:function(){return P.Dj},PluginExecutionEngine:function(){return ze},PluginManagerInstance:function(){return Vt},getBuiltInPluginInstances:function(){return ot},injectOperator:function(){return Ae},useFlowEngine:function(){return qt}});var De=E(90819),f=E.n(De),Ue=E(89933),O=E.n(Ue),Ge=E(78796),$=E.n(Ge),pt=E(4977),Z=E.n(pt),L=E(10154),I=E.n(L),pe=E(41553),Q=E.n(pe),ke=E(78846),ce=E.n(ke),Y=E(54088),de=E.n(Y),mt=E(49488),me=E.n(mt),Xe=E(84047),Ne=E.n(Xe),Ye=E(86222),te=E.n(Ye),j=E(73193),z=E.n(j),P=E(23536),ve=function(){function N(){$()(this,N)}return Z()(N,[{key:"getNodeFormConfig",value:function(){return null}},{key:"executeNode",value:function(){var v=O()(f()().mark(function r(n,u,a){var c,g,t,i,o;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(g=(c=n.data)===null||c===void 0||(c=c.config)===null||c===void 0?void 0:c.conditions,t=!0,l.prev=2,!(g&&Object.keys(g).length>0)){l.next=7;break}return l.next=6,u.evaluateRule(g,n.id);case 6:t=l.sent;case 7:l.next=12;break;case 9:l.prev=9,l.t0=l.catch(2),t=!1;case 12:if(t){l.next=15;break}return a&&(a.status=P.e4.PENDING,a.endTime=new Date,a.duration=a.startTime?a.endTime.getTime()-a.startTime.getTime():0,a.contextAfter=z()({},u.getContextManager().getVariables())),l.abrupt("return",!1);case 15:if(i=!0,l.prev=16,!((o=n.data)!==null&&o!==void 0&&(o=o.config)!==null&&o!==void 0&&o.event)){l.next=21;break}return l.next=20,u.evaluateMethod(n.data.config.event,n.id);case 20:i=l.sent;case 21:l.next=26;break;case 23:l.prev=23,l.t1=l.catch(16),i=!1;case 26:return a&&(a.status=i?P.e4.SUCCESS:P.e4.FAILED,a.endTime=new Date,a.duration=a.startTime?a.endTime.getTime()-a.startTime.getTime():0,a.contextAfter=z()({},u.getContextManager().getVariables()),a.engineResult=i),l.abrupt("return",!!i);case 28:case"end":return l.stop()}},r,null,[[2,9],[16,23]])}));function e(r,n,u){return v.apply(this,arguments)}return e}()},{key:"getExecuteNodeStatus",value:function(){var v=O()(f()().mark(function r(n,u){return f()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",P.e4.SUCCESS);case 1:case"end":return c.stop()}},r)}));function e(r,n){return v.apply(this,arguments)}return e}()},{key:"getNextNodeId",value:function(){var v=O()(f()().mark(function r(n,u,a){var c,g,t,i,o,s;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(!n||n.length===0)){d.next=2;break}return d.abrupt("return",null);case 2:c=te()(n),d.prev=3,c.s();case 5:if((g=c.n()).done){d.next=20;break}if(t=g.value,d.prev=7,!((i=t.data)!==null&&i!==void 0&&i.conditions)){d.next=14;break}return d.next=11,u.evaluateRule(t.data.conditions,t.id);case 11:if(o=d.sent,!o){d.next=14;break}return d.abrupt("return",t.target);case 14:d.next=18;break;case 16:d.prev=16,d.t0=d.catch(7);case 18:d.next=5;break;case 20:d.next=25;break;case 22:d.prev=22,d.t1=d.catch(3),c.e(d.t1);case 25:return d.prev=25,c.f(),d.finish(25);case 28:if(s=n.find(function(p){var h;return(h=p.data)===null||h===void 0?void 0:h.isDefault}),!s){d.next=31;break}return d.abrupt("return",s.target);case 31:return d.abrupt("return",n[0].target);case 32:case"end":return d.stop()}},r,null,[[3,22,25,28],[7,16]])}));function e(r,n,u){return v.apply(this,arguments)}return e}()},{key:"shouldExecuteNode",value:function(){var v=O()(f()().mark(function r(n,u){var a,c;return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(c=(a=n.data)===null||a===void 0||(a=a.config)===null||a===void 0?void 0:a.conditions,!(!c||Object.keys(c).length===0)){t.next=3;break}return t.abrupt("return",!0);case 3:return t.prev=3,t.next=6,u.evaluateRule(c,n.id);case 6:return t.abrupt("return",t.sent);case 9:return t.prev=9,t.t0=t.catch(3),t.abrupt("return",!1);case 12:case"end":return t.stop()}},r,null,[[3,9]])}));function e(r,n){return v.apply(this,arguments)}return e}()},{key:"onNodeComplete",value:function(){var v=O()(f()().mark(function r(n,u,a,c){var g,t,i,o;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(c){l.next=2;break}return l.abrupt("return");case 2:return l.next=4,u.getNextNodeId(n.id,a);case 4:if(g=l.sent,!Array.isArray(g)){l.next=25;break}t=te()(g),l.prev=7,t.s();case 9:if((i=t.n()).done){l.next=15;break}return o=i.value,l.next=13,u.executeNode(o);case 13:l.next=9;break;case 15:l.next=20;break;case 17:l.prev=17,l.t0=l.catch(7),t.e(l.t0);case 20:return l.prev=20,t.f(),l.finish(20);case 23:l.next=28;break;case 25:if(typeof g!="string"){l.next=28;break}return l.next=28,u.executeNode(g);case 28:case"end":return l.stop()}},r,null,[[7,17,20,23]])}));function e(r,n,u,a){return v.apply(this,arguments)}return e}()}]),N}(),He=P.FR.Trigger,Ve="\u89E6\u53D1\u5668\u8282\u70B9",Nt={schema:{type:He,label:Ve,config:[{field:"api_key",label:"API\u5BC6\u94A5",type:"ant_Checkbox.Group",formItemProps:{rules:[{required:!0,message:"\u8BF7\u9009\u62E9API\u5BC6\u94A5"}]},widgetProps:{placeholder:"\u8BF7\u8F93\u5165Dify API\u5BC6\u94A5",options:[{value:"key1",label:"\u5BC6\u94A51"},{value:"key2",label:"\u5BC6\u94A52"}]}},{field:"project_id",label:"\u9879\u76EEID",type:"ant_Input",formItemProps:{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u9879\u76EEID"}]},widgetProps:{placeholder:"\u8BF7\u8F93\u5165\u9879\u76EEID"}},{field:"model",label:"\u6A21\u578B\u9009\u62E9",type:"ant_Select",widgetProps:{placeholder:"\u8BF7\u9009\u62E9\u6A21\u578B",options:[{value:"gpt-4",label:"GPT-4"},{value:"gpt-4o",label:"GPT-4o"},{value:"qwen-long",label:"Qwen-Long"}]}}]}},Je=Nt,yt=function(N){me()(e,N);var v=Ne()(e);function e(){var r;$()(this,e);for(var n=arguments.length,u=new Array(n),a=0;a<n;a++)u[a]=arguments[a];return r=v.call.apply(v,[this].concat(u)),I()(Q()(r),"pluginNodeType",He),I()(Q()(r),"pluginNodeTypeName",Ve),r}return Z()(e,[{key:"getNodeFormConfig",value:function(){return Je}},{key:"getExecuteNodeStatus",value:function(){var r=O()(f()().mark(function u(a,c){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ce()(de()(e.prototype),"getExecuteNodeStatus",this).call(this,a,c));case 1:case"end":return t.stop()}},u,this)}));function n(u,a){return r.apply(this,arguments)}return n}()}]),e}(ve),Et=yt,Qe=P.FR.Action,qe="\u52A8\u4F5C\u8282\u70B9",Ct={schema:{type:Qe,label:qe,config:[{field:"api_key",label:"API\u5BC6\u94A5",type:"ant_Checkbox.Group",widget:"ant_Checkbox.Group",formItemProps:{rules:[{required:!0,message:"\u8BF7\u9009\u62E9API\u5BC6\u94A5"}]},widgetProps:{options:[{value:"key1",label:"\u5BC6\u94A51"},{value:"key2",label:"\u5BC6\u94A52"}]}},{field:"action_type",label:"\u952E\u503C\u5BF9",type:"key-value-editor",formItemProps:{rules:[{required:!0,message:"\u8BF7\u914D\u7F6E\u952E\u503C\u5BF9"},{validator:function(v,e){var r=Array.isArray(e)?e:[];if(!r||r.length===0)return Promise.resolve();var n=r.map(function(g){var t;return((t=g==null?void 0:g.key)!==null&&t!==void 0?t:"").trim()}),u=n.findIndex(function(g){return!g});if(u!==-1)return Promise.reject(new Error("\u5B58\u5728\u7A7A\u952E\uFF08\u7B2C".concat(u+1,"\u9879\uFF09")));var a=new Set,c=new Set;return n.forEach(function(g){a.has(g)?c.add(g):a.add(g)}),c.size>0?Promise.reject(new Error("\u5B58\u5728\u91CD\u590D\u952E\uFF1A".concat(Array.from(c).join(", ")))):Promise.resolve()}}]},widgetProps:{}}]}},bt=Ct,Ft=function(N){me()(e,N);var v=Ne()(e);function e(){var r;$()(this,e);for(var n=arguments.length,u=new Array(n),a=0;a<n;a++)u[a]=arguments[a];return r=v.call.apply(v,[this].concat(u)),I()(Q()(r),"pluginNodeType",Qe),I()(Q()(r),"pluginNodeTypeName",qe),r}return Z()(e,[{key:"getNodeFormConfig",value:function(){return bt}},{key:"getExecuteNodeStatus",value:function(){var r=O()(f()().mark(function u(a,c){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ce()(de()(e.prototype),"getExecuteNodeStatus",this).call(this,a,c));case 1:case"end":return t.stop()}},u,this)}));function n(u,a){return r.apply(this,arguments)}return n}()}]),e}(ve),wt=Ft,_e=P.FR.Branch,et="\u5206\u652F\u8282\u70B9",Be={schema:{type:_e,label:et,config:[{field:"branch_rule",label:"\u5206\u652F\u6761\u4EF6",type:"ant_Input",widget:"ant_Input",formItemProps:{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5206\u652F\u6761\u4EF6"}]},widgetProps:{placeholder:"\u8BF7\u8F93\u5165\u5206\u652F\u6761\u4EF6"}}]}},kt=Be,It=function(N){me()(e,N);var v=Ne()(e);function e(){var r;$()(this,e);for(var n=arguments.length,u=new Array(n),a=0;a<n;a++)u[a]=arguments[a];return r=v.call.apply(v,[this].concat(u)),I()(Q()(r),"pluginNodeType",_e),I()(Q()(r),"pluginNodeTypeName",et),r}return Z()(e,[{key:"getNodeFormConfig",value:function(){return kt}},{key:"getExecuteNodeStatus",value:function(){var r=O()(f()().mark(function u(a,c){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ce()(de()(e.prototype),"getExecuteNodeStatus",this).call(this,a,c));case 1:case"end":return t.stop()}},u,this)}));function n(u,a){return r.apply(this,arguments)}return n}()},{key:"getNextNodeId",value:function(){var r=O()(f()().mark(function u(a,c,g){var t,i,o,s,l,d,p,h,y,m,b,A,w,D;return f()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(a.length!==0){F.next=2;break}return F.abrupt("return",null);case 2:t=[],i=c.getContextManager(),o=i.getVariables(),console.log("[BranchNodePlugin] \u5F53\u524D\u4E0A\u4E0B\u6587\u53D8\u91CF:",o),console.log("[BranchNodePlugin] \u53EF\u7528\u7684\u8FB9:",a.map(function(C){var G,H;return{id:C.id,target:C.target,conditions:(G=C.data)===null||G===void 0?void 0:G.conditions,isDefault:(H=C.data)===null||H===void 0?void 0:H.isDefault}})),s=te()(a),F.prev=8,s.s();case 10:if((l=s.n()).done){F.next=27;break}if(p=l.value,(d=p.data)!==null&&d!==void 0&&d.isDefault){F.next=25;break}return F.prev=13,console.log("[BranchNodePlugin] \u8BC4\u4F30\u8FB9 ".concat(p.id," \u7684\u6761\u4EF6:"),(h=p.data)===null||h===void 0?void 0:h.conditions),F.next=17,c.evaluateRule(p==null||(y=p.data)===null||y===void 0?void 0:y.conditions,p.id);case 17:m=F.sent,console.log("[BranchNodePlugin] \u8FB9 ".concat(p.id," \u8BC4\u4F30\u7ED3\u679C:"),m),m&&t.push(p),F.next=25;break;case 22:F.prev=22,F.t0=F.catch(13),console.log("[BranchNodePlugin] \u8FB9 ".concat(p.id," \u7684\u89C4\u5219\u8BC4\u4F30\u5931\u8D25:"),F.t0);case 25:F.next=10;break;case 27:F.next=32;break;case 29:F.prev=29,F.t1=F.catch(8),s.e(F.t1);case 32:return F.prev=32,s.f(),F.finish(32);case 35:if(b=null,!(t.length>1)){F.next=42;break}console.warn("\u5206\u652F\u8282\u70B9\u6709".concat(t.length,"\u6761\u8FB9\u7684\u89C4\u5219\u90FD\u6EE1\u8DB3\uFF0C\u9009\u62E9\u4F18\u5148\u7EA7\u6700\u9AD8\u7684\u8FB9")),t.sort(function(C,G){var H,R;return(((H=G.data)===null||H===void 0?void 0:H.priority)||0)-(((R=C.data)===null||R===void 0?void 0:R.priority)||0)}),b=t[0],F.next=52;break;case 42:if(t.length!==1){F.next=46;break}b=t[0],F.next=52;break;case 46:if(A=a.find(function(C){var G;return(G=C.data)===null||G===void 0?void 0:G.isDefault}),!A){F.next=51;break}b=A,F.next=52;break;case 51:throw new Error("\u5206\u652F\u8282\u70B9\u6CA1\u6709\u914D\u7F6E\u9ED8\u8BA4\u7684\u8FB9");case 52:return console.log("[BranchNodePlugin] \u5339\u914D\u7684\u8FB9\u6570\u91CF: ".concat(t.length)),console.log("[BranchNodePlugin] \u6700\u7EC8\u9009\u62E9\u7684\u8FB9:",b),console.log("[BranchNodePlugin] \u4E0B\u4E00\u4E2A\u8282\u70B9ID: ".concat(b.target)),g&&(g.decision={selectPath:b.target,conditions:(w=b.data)===null||w===void 0?void 0:w.conditions,isDefault:!!((D=b)!==null&&D!==void 0&&(D=D.data)!==null&&D!==void 0&&D.isDefault)}),F.abrupt("return",b.target);case 57:case"end":return F.stop()}},u,null,[[8,29,32,35],[13,22]])}));function n(u,a,c){return r.apply(this,arguments)}return n}()}]),e}(ve),St=It,tt=P.FR.Parallel,nt="\u5E76\u884C\u8282\u70B9",Dt={schema:{type:tt,label:nt,config:[{field:"api_key",label:"API\u5BC6\u94A5",type:"ant_Radio.Group",widget:"ant_Radio.Group",formItemProps:{rules:[{required:!0,message:"\u8BF7\u9009\u62E9API\u5BC6\u94A5"}]},widgetProps:{options:[{value:"key1",label:"\u5BC6\u94A51"},{value:"key2",label:"\u5BC6\u94A52"}]}}]}},Tt=Dt,At=function(N){me()(e,N);var v=Ne()(e);function e(){var r;$()(this,e);for(var n=arguments.length,u=new Array(n),a=0;a<n;a++)u[a]=arguments[a];return r=v.call.apply(v,[this].concat(u)),I()(Q()(r),"pluginNodeType",tt),I()(Q()(r),"pluginNodeTypeName",nt),r}return Z()(e,[{key:"getNodeFormConfig",value:function(){return Tt}},{key:"getExecuteNodeStatus",value:function(){var r=O()(f()().mark(function u(a,c){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ce()(de()(e.prototype),"getExecuteNodeStatus",this).call(this,a,c));case 1:case"end":return t.stop()}},u,this)}));function n(u,a){return r.apply(this,arguments)}return n}()},{key:"executeNode",value:function(){var r=O()(f()().mark(function u(a,c,g){var t;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return a.data||(a.data={}),a.data.config||(a.data.config={}),t=a.data.config,t.parallel_strategy||(t.parallel_strategy=P.Dj.ALL),g&&(g.parallel_strategy=t.parallel_strategy),o.abrupt("return",ce()(de()(e.prototype),"executeNode",this).call(this,a,c,g));case 6:case"end":return o.stop()}},u,this)}));function n(u,a,c){return r.apply(this,arguments)}return n}()},{key:"getNextNodeId",value:function(){var r=O()(f()().mark(function u(a,c,g){var t,i,o,s,l,d,p;return f()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(a.length!==0){y.next=2;break}return y.abrupt("return",null);case 2:t=[],i=te()(a),y.prev=4,i.s();case 6:if((o=i.n()).done){y.next=20;break}return s=o.value,y.prev=8,y.next=11,c.evaluateRule(s==null||(l=s.data)===null||l===void 0?void 0:l.conditions);case 11:p=y.sent,(p||s!=null&&(d=s.data)!==null&&d!==void 0&&d.isDefault)&&t.push(s),y.next=18;break;case 15:y.prev=15,y.t0=y.catch(8),console.error("\u8BC4\u4F30\u5E76\u884C\u8FB9\u6761\u4EF6\u5931\u8D25:",y.t0);case 18:y.next=6;break;case 20:y.next=25;break;case 22:y.prev=22,y.t1=y.catch(4),i.e(y.t1);case 25:return y.prev=25,i.f(),y.finish(25);case 28:return g&&(g.parallel_edges=t.map(function(m){var b,A,w;return{target:m.target,conditions:(b=(A=m.data)===null||A===void 0?void 0:A.conditions)!==null&&b!==void 0?b:{all:[]},isDefault:!!((w=m.data)!==null&&w!==void 0&&w.isDefault)}})),y.abrupt("return",t.map(function(m){return m.target}));case 30:case"end":return y.stop()}},u,null,[[4,22,25,28],[8,15]])}));function n(u,a,c){return r.apply(this,arguments)}return n}()},{key:"onNodeComplete",value:function(){var r=O()(f()().mark(function u(a,c,g,t){var i,o,s,l,d,p;return f()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(t!==!0){y.next=16;break}return i=c.getOutgoingEdges(a.id),y.next=4,this.getNextNodeId(i,c,g);case 4:if(o=y.sent,!Array.isArray(o)){y.next=13;break}return l=P.Dj.ALL,d=(s=a.data)===null||s===void 0||(s=s.config)===null||s===void 0?void 0:s.parallel_strategy,typeof d=="string"?(p=d.toUpperCase(),P.Dj[p]!==void 0&&(l=P.Dj[p])):d!==void 0&&(l=d),y.next=11,this.executeNodesInParallel(o,c,l);case 11:y.next=16;break;case 13:if(typeof o!="string"){y.next=16;break}return y.next=16,c.executeNode(o);case 16:case"end":return y.stop()}},u,this)}));function n(u,a,c,g){return r.apply(this,arguments)}return n}()},{key:"executeNodesInParallel",value:function(){var r=O()(f()().mark(function u(a,c){var g=this,t,i,o,s,l,d,p,h=arguments;return f()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(t=h.length>2&&h[2]!==void 0?h[2]:P.Dj.ALL,!(!a||a.length===0)){m.next=3;break}return m.abrupt("return",!0);case 3:return i=a.map(function(){return z()({},c.getContextManager().getVariables())}),o=a.map(function(b,A){return g.executeNodeInParallelContext(b,i[A],c)}),m.next=7,Promise.all(o);case 7:if(s=m.sent,this.mergeParallelContexts(c,i),t!==P.Dj.ALL){m.next=15;break}return l=s.every(function(b){return b}),c.setHasFailed(!l),m.abrupt("return",l);case 15:if(t!==P.Dj.ANY){m.next=19;break}return d=s.some(function(b){return b}),c.setHasFailed(!d),m.abrupt("return",d);case 19:return p=s.every(function(b){return b}),c.setHasFailed(!p),m.abrupt("return",p);case 22:case"end":return m.stop()}},u,this)}));function n(u,a){return r.apply(this,arguments)}return n}()},{key:"executeNodeInParallelContext",value:function(){var r=O()(f()().mark(function u(a,c,g){var t,i,o;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t=z()({},g.getContextManager().getVariables()),i=g.hasFailed,g.getContextManager().updateVariables(c),l.prev=3,l.next=6,g.executeNode(a);case 6:return o=l.sent,Object.assign(c,g.getContextManager().getVariables()),l.abrupt("return",o);case 9:return l.prev=9,g.getContextManager().updateVariables(t),g.setHasFailed(i),l.finish(9);case 13:case"end":return l.stop()}},u,null,[[3,,9,13]])}));function n(u,a,c){return r.apply(this,arguments)}return n}()},{key:"mergeParallelContexts",value:function(n,u){var a={};u.forEach(function(c){Object.assign(a,c)}),n.getContextManager().updateVariables(a)}}]),e}(ve),Pt=At,rt=P.FR.Iteration,at="\u8FED\u4EE3\u8282\u70B9",Mt={schema:{type:rt,label:at,config:[{field:"api_key",label:"API\u5BC6\u94A5",type:"ant_Radio.Group",widget:"ant_Radio.Group",formItemProps:{rules:[{required:!0,message:"\u8BF7\u9009\u62E9API\u5BC6\u94A5"}]},widgetProps:{options:[{value:"key1",label:"\u5BC6\u94A51"},{value:"key2",label:"\u5BC6\u94A52"}]}}]}},Bt=Mt,Ot=function(N){me()(e,N);var v=Ne()(e);function e(){var r;$()(this,e);for(var n=arguments.length,u=new Array(n),a=0;a<n;a++)u[a]=arguments[a];return r=v.call.apply(v,[this].concat(u)),I()(Q()(r),"pluginNodeType",rt),I()(Q()(r),"pluginNodeTypeName",at),r}return Z()(e,[{key:"getNodeFormConfig",value:function(){return Bt}},{key:"invokeEvent",value:function(){var r=O()(f()().mark(function u(a,c,g){var t,i,o,s,l,d,p,h,y,m,b,A,w,D,M;return f()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!(!((t=a.data)!==null&&t!==void 0&&(t=t.config)!==null&&t!==void 0&&t.event)||!((i=a.data)!==null&&i!==void 0&&(i=i.config)!==null&&i!==void 0&&i.event.type))){C.next=2;break}return C.abrupt("return",!0);case 2:l=((o=a.data)===null||o===void 0||(o=o.config)===null||o===void 0?void 0:o.iteration_count)||1,d=(s=a.data)===null||s===void 0||(s=s.config)===null||s===void 0?void 0:s.iteration_mode,p=this.normalizeIterationMode(d),C.prev=5,C.t0=p,C.next=C.t0===P.jc.ALL_SUCCESS?9:C.t0===P.jc.ANY_SUCCESS?19:C.t0===P.jc.ANY_FAILURE?29:39;break;case 9:if(!(l>0)){C.next=18;break}return C.next=12,c.evaluateMethod((h=a.data)===null||h===void 0||(h=h.config)===null||h===void 0?void 0:h.event,a.id);case 12:if(y=C.sent,y){C.next=15;break}return C.abrupt("return",!1);case 15:l--,C.next=9;break;case 18:return C.abrupt("break",49);case 19:if(!(l>0)){C.next=28;break}return C.next=22,c.evaluateMethod((m=a.data)===null||m===void 0||(m=m.config)===null||m===void 0?void 0:m.event,a.id);case 22:if(b=C.sent,!b){C.next=25;break}return C.abrupt("return",!0);case 25:l--,C.next=19;break;case 28:return C.abrupt("return",!1);case 29:if(!(l>0)){C.next=38;break}return C.next=32,c.evaluateMethod((A=a.data)===null||A===void 0||(A=A.config)===null||A===void 0?void 0:A.event,a.id);case 32:if(w=C.sent,w){C.next=35;break}return C.abrupt("return",!1);case 35:l--,C.next=29;break;case 38:return C.abrupt("return",!0);case 39:if(!(l>0)){C.next=48;break}return C.next=42,c.evaluateMethod((D=a.data)===null||D===void 0||(D=D.config)===null||D===void 0?void 0:D.event,a.id);case 42:if(M=C.sent,M){C.next=45;break}return C.abrupt("return",!1);case 45:l--,C.next=39;break;case 48:return C.abrupt("break",49);case 49:return C.abrupt("return",!0);case 52:throw C.prev=52,C.t1=C.catch(5),new Error(C.t1 instanceof Error?C.t1.message:String(C.t1));case 55:case"end":return C.stop()}},u,this,[[5,52]])}));function n(u,a,c){return r.apply(this,arguments)}return n}()},{key:"getExecuteNodeStatus",value:function(){var r=O()(f()().mark(function u(a,c){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ce()(de()(e.prototype),"getExecuteNodeStatus",this).call(this,a,c));case 1:case"end":return t.stop()}},u,this)}));function n(u,a){return r.apply(this,arguments)}return n}()},{key:"executeNode",value:function(){var r=O()(f()().mark(function u(a,c,g){var t;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.invokeEvent(a,c,g);case 2:return t=o.sent,g&&(g.status=t?P.e4.SUCCESS:P.e4.FAILED,g.endTime=new Date,g.duration=g.startTime?g.endTime.getTime()-g.startTime.getTime():0,g.contextAfter=z()({},c.getContextManager().getVariables()),g.engineResult=t),o.abrupt("return",t);case 5:case"end":return o.stop()}},u,this)}));function n(u,a,c){return r.apply(this,arguments)}return n}()},{key:"normalizeIterationMode",value:function(n){if(typeof n=="number"&&Object.values(P.jc).includes(n))return n;if(typeof n=="string"){var u=Number(n);if(!Number.isNaN(u)&&Object.values(P.jc).includes(u))return u;var a=n.toUpperCase().replace(/\s+/g,"").replace(/-/g,"_"),c=P.jc[a];if(c!==void 0)return c}return P.jc.ALL_SUCCESS}}]),e}(ve),Lt=Ot,ut=P.FR.Merge,it="\u5408\u5E76\u8282\u70B9",Rt={schema:{type:ut,label:it,config:[{field:"api_key",label:"API\u5BC6\u94A5",type:"ant_Radio.Group",widget:"ant_Radio.Group",formItemProps:{rules:[{required:!0,message:"\u8BF7\u9009\u62E9API\u5BC6\u94A5"}]},widgetProps:{options:[{value:"key1",label:"\u5BC6\u94A51"},{value:"key2",label:"\u5BC6\u94A52"}]}}]}},xt=Rt,$t=function(N){me()(e,N);var v=Ne()(e);function e(){var r;$()(this,e);for(var n=arguments.length,u=new Array(n),a=0;a<n;a++)u[a]=arguments[a];return r=v.call.apply(v,[this].concat(u)),I()(Q()(r),"pluginNodeType",ut),I()(Q()(r),"pluginNodeTypeName",it),r}return Z()(e,[{key:"getNodeFormConfig",value:function(){return xt}},{key:"checkAllPredecessorNodes",value:function(){var r=O()(f()().mark(function u(a,c){var g,t,i,o,s,l,d;return f()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(h.prev=0,g=c.getIncomingEdges(a.id),g.length!==0){h.next=4;break}return h.abrupt("return",!0);case 4:t=g.map(function(y){return y.source}),i=c.getExecutionHistory(),o=te()(t),h.prev=7,l=f()().mark(function y(){var m,b,A;return f()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(m=s.value,b=i.filter(function(M){return M.nodeId===m}),b.length!==0){D.next=5;break}return console.log("\u524D\u7F6E\u8282\u70B9 ".concat(m," \u5C1A\u672A\u6267\u884C\uFF0C\u5408\u5E76\u8282\u70B9\u7B49\u5F85...")),D.abrupt("return",{v:!1});case 5:if(A=b.reduce(function(M,F){return F.timestamp>M.timestamp?F:M}),A.status!==P.e4.FAILED){D.next=11;break}return console.log("\u524D\u7F6E\u8282\u70B9 ".concat(m," \u6267\u884C\u5931\u8D25\uFF0C\u5408\u5E76\u8282\u70B9\u65E0\u6CD5\u7EE7\u7EED\u6267\u884C")),D.abrupt("return",{v:!1});case 11:if(A.status===P.e4.SUCCESS){D.next=14;break}return console.log("\u524D\u7F6E\u8282\u70B9 ".concat(m," \u6267\u884C\u72B6\u6001\u4E3A ").concat(A.status,"\uFF0C\u5408\u5E76\u8282\u70B9\u7B49\u5F85...")),D.abrupt("return",{v:!1});case 14:case"end":return D.stop()}},y)}),o.s();case 10:if((s=o.n()).done){h.next=17;break}return h.delegateYield(l(),"t0",12);case 12:if(d=h.t0,!d){h.next=15;break}return h.abrupt("return",d.v);case 15:h.next=10;break;case 17:h.next=22;break;case 19:h.prev=19,h.t1=h.catch(7),o.e(h.t1);case 22:return h.prev=22,o.f(),h.finish(22);case 25:return h.abrupt("return",!0);case 28:return h.prev=28,h.t2=h.catch(0),console.error("\u68C0\u67E5\u524D\u7F6E\u8282\u70B9\u72B6\u6001\u65F6\u53D1\u751F\u9519\u8BEF:",h.t2),h.abrupt("return",!1);case 32:case"end":return h.stop()}},u,null,[[0,28],[7,19,22,25]])}));function n(u,a){return r.apply(this,arguments)}return n}()},{key:"shouldExecuteNode",value:function(){var r=O()(f()().mark(function u(a,c){var g;return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.checkAllPredecessorNodes(a,c);case 2:return g=i.sent,g||console.log("\u5408\u5E76\u8282\u70B9 ".concat(a.id," \u7684\u524D\u7F6E\u8282\u70B9\u5C1A\u672A\u5168\u90E8\u5B8C\u6210\uFF0C\u8DF3\u8FC7\u6267\u884C")),i.abrupt("return",g);case 5:case"end":return i.stop()}},u,this)}));function n(u,a){return r.apply(this,arguments)}return n}()},{key:"getExecuteNodeStatus",value:function(){var r=O()(f()().mark(function u(a,c){var g,t,i,o;return f()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.checkAllPredecessorNodes(a,c);case 2:if(g=l.sent,g){l.next=5;break}return l.abrupt("return",P.e4.PENDING);case 5:if(t=c.getExecutionHistory(),i=t.filter(function(d){return d.nodeId===a.id}),!(i.length>0)){l.next=10;break}return o=i.reduce(function(d,p){return p.timestamp>d.timestamp?p:d}),l.abrupt("return",o.status);case 10:return l.abrupt("return",P.e4.PENDING);case 11:case"end":return l.stop()}},u,this)}));function n(u,a){return r.apply(this,arguments)}return n}()}]),e}(ve),jt=$t,st=P.FR.End,q="\u7ED3\u675F\u8282\u70B9",Ut={schema:{type:st,label:q,config:[{field:"api_key",label:"API\u5BC6\u94A5",type:"ant_Radio.Group",widget:"ant_Radio.Group",formItemProps:{rules:[{required:!0,message:"\u8BF7\u9009\u62E9API\u5BC6\u94A5"}]},widgetProps:{options:[{value:"key1",label:"\u5BC6\u94A51"},{value:"key2",label:"\u5BC6\u94A52"}]}}]}},Gt=Ut,Ht=function(N){me()(e,N);var v=Ne()(e);function e(){var r;$()(this,e);for(var n=arguments.length,u=new Array(n),a=0;a<n;a++)u[a]=arguments[a];return r=v.call.apply(v,[this].concat(u)),I()(Q()(r),"pluginNodeType",st),I()(Q()(r),"pluginNodeTypeName",q),r}return Z()(e,[{key:"getNodeFormConfig",value:function(){return Gt}},{key:"getExecuteNodeStatus",value:function(){var r=O()(f()().mark(function u(a,c){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ce()(de()(e.prototype),"getExecuteNodeStatus",this).call(this,a,c));case 1:case"end":return t.stop()}},u,this)}));function n(u,a){return r.apply(this,arguments)}return n}()},{key:"executeNode",value:function(){var r=O()(f()().mark(function u(a,c,g){var t;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,ce()(de()(e.prototype),"executeNode",this).call(this,a,c,g);case 2:return t=o.sent,t&&g&&(g.is_end_node=!0),o.abrupt("return",t);case 5:case"end":return o.stop()}},u,this)}));function n(u,a,c){return r.apply(this,arguments)}return n}()},{key:"getNextNodeId",value:function(){var r=O()(f()().mark(function u(a,c,g){return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",null);case 1:case"end":return i.stop()}},u)}));function n(u,a,c){return r.apply(this,arguments)}return n}()},{key:"onNodeComplete",value:function(){var r=O()(f()().mark(function u(a,c,g,t){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,ce()(de()(e.prototype),"onNodeComplete",this).call(this,a,c,g,t);case 2:g.is_end_node=!0;case 3:case"end":return o.stop()}},u,this)}));function n(u,a,c,g){return r.apply(this,arguments)}return n}()}]),e}(ve),Te=Ht,Oe=null;function ot(){if(Oe)return Oe;var N=[new Et,new wt,new St,new Pt,new Lt,new jt,new Te];return Oe=N,Oe}var T=function(){function N(){$()(this,N),I()(this,"plugins",new Map),this.registerBuiltInPlugins()}return Z()(N,[{key:"registerBuiltInPlugins",value:function(){var e=ot();this.registerAllPlugin(e),console.log(this.getAllPluginNodeTypes()),console.log("[PluginManager] \u5DF2\u81EA\u52A8\u6CE8\u518C\u6240\u6709\u5185\u7F6E\u8282\u70B9\u63D2\u4EF6")}},{key:"registerPlugin",value:function(e){this.plugins.set(e.pluginNodeType,e),console.log("[PluginManager] \u5DF2\u6CE8\u518C\u8282\u70B9\u7C7B\u578B ".concat(e.pluginNodeType," \u7684\u63D2\u4EF6"))}},{key:"registerAllPlugin",value:function(e){var r=this;e.forEach(function(n){r.registerPlugin(n)})}},{key:"getPlugin",value:function(e){var r=this.plugins.get(e);if(!r)throw new Error("\u672A\u627E\u5230\u8282\u70B9\u7C7B\u578B ".concat(e," \u7684\u63D2\u4EF6"));return r}},{key:"hasPlugin",value:function(e){return this.plugins.has(e)}},{key:"getAllPlugins",value:function(){return Array.from(this.plugins.values())}},{key:"getNodeFormConfig",value:function(e){var r,n=this.getPlugin(e),u=(r=n.getNodeFormConfig)===null||r===void 0?void 0:r.call(n);return u}},{key:"getAllPluginNodeTypes",value:function(){return this.getAllPlugins().map(function(e){return{value:e.pluginNodeType,label:e.pluginNodeTypeName}})}},{key:"getExecuteNodeStatus",value:function(){var v=O()(f()().mark(function r(n,u){var a,c,g;return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return c=this.getPlugin((a=n.data)===null||a===void 0?void 0:a.pluginNodeType),i.prev=1,i.next=4,c.getExecuteNodeStatus(n,u);case 4:return g=i.sent,i.abrupt("return",g);case 8:throw i.prev=8,i.t0=i.catch(1),new Error(i.t0 instanceof Error?i.t0.message:String(i.t0));case 11:case"end":return i.stop()}},r,this,[[1,8]])}));function e(r,n){return v.apply(this,arguments)}return e}()},{key:"executeNode",value:function(){var v=O()(f()().mark(function r(n,u,a){var c,g;return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return g=this.getPlugin((c=n.data)===null||c===void 0?void 0:c.pluginNodeType),i.prev=1,i.next=4,g.executeNode(n,u,a);case 4:return i.abrupt("return",i.sent);case 7:throw i.prev=7,i.t0=i.catch(1),new Error(i.t0 instanceof Error?i.t0.message:String(i.t0));case 10:case"end":return i.stop()}},r,this,[[1,7]])}));function e(r,n,u){return v.apply(this,arguments)}return e}()},{key:"getNextNodeId",value:function(){var v=O()(f()().mark(function r(n,u,a,c){var g,t,i;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,t=this.getPlugin((g=n.data)===null||g===void 0?void 0:g.pluginNodeType),s.next=4,t.getNextNodeId(u,a,c);case 4:return i=s.sent,s.abrupt("return",i);case 8:throw s.prev=8,s.t0=s.catch(0),new Error(s.t0 instanceof Error?"\u83B7\u53D6\u8FB9\u5931\u8D25: ".concat(s.t0.message):"\u83B7\u53D6\u8FB9\u5931\u8D25: ".concat(String(s.t0)));case 11:case"end":return s.stop()}},r,this,[[0,8]])}));function e(r,n,u,a){return v.apply(this,arguments)}return e}()}],[{key:"getInstance",value:function(){return N.instance||(N.instance=new N),N.instance}}]),N}();I()(T,"instance",void 0);function Vt(){return T.getInstance()}var on=null,Wt=E(45332),ye=E.n(Wt),Zt=E(39378),k=E.n(Zt),lt=new Map;function Ae(N,v){!N||typeof v!="function"||lt.set(N,v)}var ln={start_with:function(v,e){return k().isString(v)&&k().isString(e)?k().startsWith(v,e):!k().isNil(v)&&!k().isNil(e)?k().startsWith(k().toString(v),k().toString(e)):!1},end_with:function(v,e){return k().isString(v)&&k().isString(e)?k().endsWith(v,e):!k().isNil(v)&&!k().isNil(e)?k().endsWith(k().toString(v),k().toString(e)):!1},include:function(v,e){return k().isArray(v)?k().isArray(e)?k().every(e,function(r){return k().includes(v,r)}):k().includes(v,e):k().isString(v)&&k().isString(e)?k().includes(v,e):!1},not_include:function(v,e){return k().isArray(v)?k().isArray(e)?!k().every(e,function(r){return k().includes(v,r)}):!k().includes(v,e):k().isString(v)&&k().isString(e)?!k().includes(v,e):!1},regex:function(v,e){var r=null;if(e instanceof RegExp)r=e;else if(k().isString(e))try{r=new RegExp(e)}catch(n){return!1}else return!1;return r.test(k().toString(v))},between:function(v,e){if(!k().isArray(e)||e.length<2)return!1;var r=ye()(e,2),n=r[0],u=r[1],a=k().toNumber(v),c=k().toNumber(n),g=k().toNumber(u);return!k().isFinite(a)||!k().isFinite(c)||!k().isFinite(g)?!1:a>=c&&a<=g},not_between:function(v,e){if(!k().isArray(e)||e.length<2)return!1;var r=ye()(e,2),n=r[0],u=r[1],a=k().toNumber(v),c=k().toNumber(n),g=k().toNumber(u);return!k().isFinite(a)||!k().isFinite(c)||!k().isFinite(g)?!1:a<c||a>g},has_key:function(v,e){return k().isArray(e)?k().every(e,function(r){return k().isString(r)&&k().has(v,r)}):k().isString(e)?k().has(v,e):!1},is_empty:function(v){return k().isEmpty(v)},not_empty:function(v){return!k().isEmpty(v)}};function zt(N){Object.entries(ln).forEach(function(v){var e=ye()(v,2),r=e[0],n=e[1];try{N.addOperator(r,n)}catch(a){var u="[RuleOperators] \u6CE8\u518C\u64CD\u4F5C\u7B26\u5931\u8D25: ".concat(r," - ").concat(a instanceof Error?a.message:String(a));throw console.log(u),new Error(u)}})}function Pe(N){zt(N),lt.forEach(function(v,e){try{N.addOperator(e,v)}catch(n){var r="[RuleOperators] \u6CE8\u518C\u64CD\u4F5C\u7B26\u5931\u8D25: ".concat(e," - ").concat(n instanceof Error?n.message:String(n));throw console.log(r),new Error(r)}})}var Le=E(89957),Ie=E.n(Le),We=E(76711),Ce=E.n(We),ct=E(43524),ie=E(44194),Ze=function(){function N(){$()(this,N),I()(this,"instances",new Map),I()(this,"globalMethods",new Map),I()(this,"eventEmitter",new EventTarget),I()(this,"debug",!0)}return Z()(N,[{key:"log",value:function(){for(var e,r=arguments.length,n=new Array(r),u=0;u<r;u++)n[u]=arguments[u];this.debug&&(e=console).log.apply(e,["[ComponentManager]"].concat(n))}},{key:"warn",value:function(){for(var e,r=arguments.length,n=new Array(r),u=0;u<r;u++)n[u]=arguments[u];this.debug&&(e=console).warn.apply(e,["[ComponentManager]"].concat(n))}},{key:"error",value:function(e){throw new Error("[ComponentManager] ".concat(e))}},{key:"registerInstance",value:function(e,r){var n,u,a=r.current,c=a!==null?Object.getOwnPropertyNames(Object.getPrototypeOf(a)).filter(function(i){return typeof a[i]=="function"&&i!=="constructor"}):[],g=(n=a==null||(u=a.constructor)===null||u===void 0?void 0:u.name)!==null&&n!==void 0?n:"unknown",t={name:e,ref:r,methods:c,componentType:g,registeredAt:new Date};this.instances.set(e,t),this.eventEmitter.dispatchEvent(new CustomEvent("instanceRegistered",{detail:{name:e,componentType:g}})),this.log("\u5B9E\u4F8B\u5DF2\u6CE8\u518C: ".concat(e," (").concat(g,") - \u53D1\u73B0 ").concat(c.length," \u4E2A\u65B9\u6CD5"))}},{key:"unregisterInstance",value:function(e){var r=this.instances.get(e);r&&(this.instances.delete(e),this.eventEmitter.dispatchEvent(new CustomEvent("instanceUnregistered",{detail:{name:e,componentType:r.componentType}})),this.log("\u5B9E\u4F8B\u5DF2\u6CE8\u9500: ".concat(e)))}},{key:"getInstance",value:function(e){var r;return(r=this.instances.get(e))!==null&&r!==void 0?r:null}},{key:"getAllInstances",value:function(){return Array.from(this.instances.values())}},{key:"getInstancesByType",value:function(e){return Array.from(this.instances.values()).filter(function(r){return r.componentType===e})}},{key:"registerGlobalMethod",value:function(e,r,n){typeof r!="function"&&this.error("\u6CE8\u518C\u5931\u8D25\uFF1A".concat(e," \u4E0D\u662F\u4E00\u4E2A\u51FD\u6570"));var u={name:e,method:r,description:n,registeredAt:new Date};this.globalMethods.set(e,u),this.eventEmitter.dispatchEvent(new CustomEvent("globalMethodRegistered",{detail:{name:e,description:n}})),this.log("\u5168\u5C40\u65B9\u6CD5\u5DF2\u6CE8\u518C: ".concat(e).concat(n?" - ".concat(n):""))}},{key:"registerGlobalMethods",value:function(e){var r={successCount:0,failures:[]},n=te()(e),u;try{for(n.s();!(u=n.n()).done;){var a=u.value,c=a.name,g=a.method,t=a.description;try{this.registerGlobalMethod(c,g,t),r.successCount++}catch(i){r.failures.push({name:c,error:i instanceof Error?i.message:String(i)}),this.warn("\u5168\u5C40\u65B9\u6CD5\u6CE8\u518C\u5931\u8D25: ".concat(c,", \u9519\u8BEF: ").concat(i instanceof Error?i.message:String(i)))}}}catch(i){n.e(i)}finally{n.f()}return this.log("\u6279\u91CF\u6CE8\u518C\u5168\u5C40\u65B9\u6CD5\u5B8C\u6210: \u6210\u529F ".concat(r.successCount," \u4E2A, \u5931\u8D25 ").concat(r.failures.length," \u4E2A")),r}},{key:"unregisterGlobalMethod",value:function(e){this.globalMethods.has(e)&&(this.globalMethods.delete(e),this.eventEmitter.dispatchEvent(new CustomEvent("globalMethodUnregistered",{detail:{name:e}})),this.log("\u5168\u5C40\u65B9\u6CD5\u5DF2\u6CE8\u9500: ".concat(e)))}},{key:"getGlobalMethod",value:function(e){var r;return(r=this.globalMethods.get(e))!==null&&r!==void 0?r:null}},{key:"getAllGlobalMethods",value:function(){return Array.from(this.globalMethods.values())}},{key:"hasGlobalMethod",value:function(e){return this.globalMethods.has(e)}},{key:"callGlobalMethod",value:function(){var v=O()(f()().mark(function r(n){var u,a,c,g,t,i=arguments;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:for(u=this.globalMethods.get(n),u||this.error("\u672A\u627E\u5230\u5168\u5C40\u65B9\u6CD5: ".concat(n)),s.prev=2,a=i.length,c=new Array(a>1?a-1:0),g=1;g<a;g++)c[g-1]=i[g];return s.next=6,u.method.apply(u,c);case 6:return t=s.sent,this.log("\u5168\u5C40\u65B9\u6CD5\u8C03\u7528\u6210\u529F: ".concat(n),{params:c,result:t}),s.abrupt("return",t!=null?t:"\u5168\u5C40\u65B9\u6CD5\u8C03\u7528\u6210\u529F");case 11:s.prev=11,s.t0=s.catch(2),this.error("[".concat(n,"] \u5168\u5C40\u65B9\u6CD5\u8C03\u7528\u5931\u8D25: ").concat(s.t0 instanceof Error?s.t0.message:String(s.t0)));case 14:case"end":return s.stop()}},r,this,[[2,11]])}));function e(r){return v.apply(this,arguments)}return e}()},{key:"callMethod",value:function(){var v=O()(f()().mark(function r(n){var u,a,c,g,t,i,o,s,l,d,p,h=arguments;return f()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:for(u=h.length,a=new Array(u>1?u-1:0),c=1;c<u;c++)a[c-1]=h[c];if(!n.startsWith("global.")){m.next=3;break}return m.abrupt("return",this.callGlobalMethod.apply(this,[n.slice(7)].concat(a)));case 3:if(!n.startsWith("window.")){m.next=5;break}return m.abrupt("return",this.callWindowMethod.apply(this,[n.slice(7)].concat(a)));case 5:return g=n.split("."),t=ye()(g,2),i=t[0],o=t[1],(!i||!o)&&this.error("\u65E0\u6548\u7684\u65B9\u6CD5\u8DEF\u5F84: ".concat(n)),s=this.instances.get(i),s||this.error("\u672A\u627E\u5230\u5B9E\u4F8B: ".concat(i)),l=s.ref.current,l||this.error("\u5B9E\u4F8B\u672A\u6302\u8F7D: ".concat(i)),d=l[o],typeof d!="function"&&this.error("\u672A\u627E\u5230\u65B9\u6CD5: ".concat(o," in ").concat(i)),m.prev=13,m.next=16,d.call.apply(d,[l].concat(a));case 16:return p=m.sent,this.log("\u65B9\u6CD5\u8C03\u7528\u6210\u529F: ".concat(n),{params:a,result:p}),m.abrupt("return",p!=null?p:"\u65B9\u6CD5\u8C03\u7528\u6210\u529F");case 21:m.prev=21,m.t0=m.catch(13),this.error("[".concat(n,"] \u65B9\u6CD5\u8C03\u7528\u5931\u8D25: ").concat(m.t0 instanceof Error?m.t0.message:String(m.t0)));case 24:case"end":return m.stop()}},r,this,[[13,21]])}));function e(r){return v.apply(this,arguments)}return e}()},{key:"callWindowMethod",value:function(){var v=O()(f()().mark(function r(n){var u,a,c,g,t,i=arguments;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:for(typeof window=="undefined"&&this.error("\u65E0\u6CD5\u8BBF\u95EEwindow\u5BF9\u8C61\uFF0C\u5F53\u524D\u73AF\u5883\u53EF\u80FD\u662F\u670D\u52A1\u5668\u7AEF"),u=window[n],typeof u!="function"&&this.error("window\u5BF9\u8C61\u4E0A\u672A\u627E\u5230\u65B9\u6CD5: ".concat(n)),s.prev=3,a=i.length,c=new Array(a>1?a-1:0),g=1;g<a;g++)c[g-1]=i[g];return s.next=7,u.apply(void 0,c);case 7:return t=s.sent,this.log("window\u65B9\u6CD5\u8C03\u7528\u6210\u529F: ".concat(n),{params:c,result:t}),s.abrupt("return",t!=null?t:"window\u65B9\u6CD5\u8C03\u7528\u6210\u529F");case 12:s.prev=12,s.t0=s.catch(3),this.error("[".concat(n,"] window\u65B9\u6CD5\u8C03\u7528\u5931\u8D25: ").concat(s.t0 instanceof Error?s.t0.message:String(s.t0)));case 15:case"end":return s.stop()}},r,this,[[3,12]])}));function e(r){return v.apply(this,arguments)}return e}()},{key:"hasInstance",value:function(e){return this.instances.has(e)}},{key:"hasMethod",value:function(e,r){var n,u;return(n=(u=this.instances.get(e))===null||u===void 0?void 0:u.methods.includes(r))!==null&&n!==void 0?n:!1}},{key:"getInstanceMethods",value:function(e){var r,n;return(r=(n=this.instances.get(e))===null||n===void 0?void 0:n.methods)!==null&&r!==void 0?r:[]}},{key:"addEventListener",value:function(e,r){this.eventEmitter.addEventListener(e,r)}},{key:"removeEventListener",value:function(e,r){this.eventEmitter.removeEventListener(e,r)}},{key:"registerInstances",value:function(e){var r=te()(e),n;try{for(r.s();!(n=r.n()).done;){var u=n.value,a=u.name,c=u.ref;this.registerInstance(a,c)}}catch(g){r.e(g)}finally{r.f()}}},{key:"unregisterInstances",value:function(e){var r=te()(e),n;try{for(r.s();!(n=r.n()).done;){var u=n.value;this.unregisterInstance(u)}}catch(a){r.e(a)}finally{r.f()}}},{key:"clearAllOf",value:function(e,r,n){for(var u=Array.from(e.keys()),a=0,c=u;a<c.length;a++){var g=c[a];r.call(this,g)}this.log("\u6240\u6709".concat(n,"\u5DF2\u6E05\u7A7A"))}},{key:"clearAllGlobalMethods",value:function(){this.clearAllOf(this.globalMethods,this.unregisterGlobalMethod,"\u5168\u5C40\u65B9\u6CD5")}},{key:"clearAllInstances",value:function(){this.clearAllOf(this.instances,this.unregisterInstance,"\u5B9E\u4F8B")}},{key:"clearAll",value:function(){this.clearAllInstances(),this.clearAllGlobalMethods(),this.log("\u6240\u6709\u5B9E\u4F8B\u548C\u5168\u5C40\u65B9\u6CD5\u5DF2\u6E05\u7A7A")}}],[{key:"getInstance",value:function(){return N.instance||(N.instance=new N),N.instance}}]),N}();I()(Ze,"instance",void 0);var dt=function(){return Ze.getInstance()},Cn=null,cn=function(v){return v},dn=function(v,e,r){React.useEffect(function(){return r.registerInstance(v,e),function(){return r.unregisterInstance(v)}},[v,e,r])},Kt=function(v,e,r,n){React.useEffect(function(){return n.registerGlobalMethod(v,e,r),function(){return n.unregisterGlobalMethod(v)}},[v,e,r,n])},vt=function(v,e){React.useEffect(function(){if(!(!v||v.length===0)){var r=[],n=_createForOfIteratorHelper(v),u;try{for(n.s();!(u=n.n()).done;){var a=u.value;try{e.registerGlobalMethod(a.name,a.method,a.description),r.push(a.name)}catch(c){console.warn("[ComponentManager Hook] \u5168\u5C40\u65B9\u6CD5\u6CE8\u518C\u5931\u8D25: ".concat(a.name,", \u9519\u8BEF:"),c)}}}catch(c){n.e(c)}finally{n.f()}return function(){r.forEach(function(c){try{e.unregisterGlobalMethod(c)}catch(g){console.warn("[ComponentManager Hook] \u5168\u5C40\u65B9\u6CD5\u6CE8\u9500\u5931\u8D25: ".concat(c,", \u9519\u8BEF:"),g)}})}}},[v,e])},Xt=function(){function N(){$()(this,N),I()(this,"context",void 0),I()(this,"listeners",new Set),this.context={variables:{}}}return Z()(N,[{key:"initialize",value:function(e){this.context=z()({},e),this.notifyListeners()}},{key:"getContext",value:function(){return z()({},this.context)}},{key:"getVariables",value:function(){return z()({},this.context.variables)}},{key:"updateVariables",value:function(e){this.context.variables=z()(z()({},this.context.variables),e),this.notifyListeners()}},{key:"updateContext",value:function(e){this.context=z()({},e),this.notifyListeners()}},{key:"addListener",value:function(e){var r=this;return this.listeners.add(e),e(this.getContext()),function(){return r.removeListener(e)}}},{key:"removeListener",value:function(e){this.listeners.delete(e)}},{key:"notifyListeners",value:function(){var e=this.getContext();this.listeners.forEach(function(r){try{r(e)}catch(n){console.error("\u4E0A\u4E0B\u6587\u76D1\u542C\u5668\u6267\u884C\u51FA\u9519:",n)}})}},{key:"clear",value:function(){this.context={variables:{}},this.notifyListeners()}}]),N}(),se=function(v){return v},vn=E(60731),gt=E.n(vn),ee=function(N){return N.ENGINE_NOT_INITIALIZED="ENGINE_NOT_INITIALIZED",N.ENGINE_EXECUTION_FAILED="ENGINE_EXECUTION_FAILED",N.NODE_NOT_FOUND="NODE_NOT_FOUND",N.NODE_EXECUTION_FAILED="NODE_EXECUTION_FAILED",N.NODE_PLUGIN_NOT_FOUND="NODE_PLUGIN_NOT_FOUND",N.RULE_EVALUATION_FAILED="RULE_EVALUATION_FAILED",N.RULE_CONDITION_INVALID="RULE_CONDITION_INVALID",N.EVENT_EXECUTION_FAILED="EVENT_EXECUTION_FAILED",N.EVENT_METHOD_NOT_FOUND="EVENT_METHOD_NOT_FOUND",N.CONTEXT_MANAGER_NOT_INITIALIZED="CONTEXT_MANAGER_NOT_INITIALIZED",N.CONTEXT_VARIABLE_NOT_FOUND="CONTEXT_VARIABLE_NOT_FOUND",N.INSTANCE_NOT_FOUND="INSTANCE_NOT_FOUND",N.INSTANCE_METHOD_NOT_FOUND="INSTANCE_METHOD_NOT_FOUND",N.FLOW_DEFINITION_INVALID="FLOW_DEFINITION_INVALID",N.FLOW_CIRCULAR_DEPENDENCY="FLOW_CIRCULAR_DEPENDENCY",N.FLOW_TIMEOUT="FLOW_TIMEOUT",N.UNKNOWN_ERROR="UNKNOWN_ERROR",N.VALIDATION_ERROR="VALIDATION_ERROR",N}({}),ne=function(N){return N.LOW="LOW",N.MEDIUM="MEDIUM",N.HIGH="HIGH",N.CRITICAL="CRITICAL",N}({}),be=function(N){me()(e,N);var v=Ne()(e);function e(r){var n,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ee.UNKNOWN_ERROR,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ne.MEDIUM,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return $()(this,e),n=v.call(this,r),I()(Q()(n),"code",void 0),I()(Q()(n),"severity",void 0),I()(Q()(n),"nodeId",void 0),I()(Q()(n),"timestamp",void 0),I()(Q()(n),"context",void 0),I()(Q()(n),"originalError",void 0),n.name="FlowExecutionError",n.code=u,n.severity=a,n.nodeId=c.nodeId,n.timestamp=new Date,n.context=c.context,n.originalError=c.originalError,Error.captureStackTrace&&Error.captureStackTrace(Q()(n),e),n}return Z()(e,[{key:"toJSON",value:function(){return{name:this.name,message:this.message,code:this.code,severity:this.severity,nodeId:this.nodeId,timestamp:this.timestamp.toISOString(),context:this.context,stack:this.stack,originalError:this.originalError?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:void 0}}},{key:"getUserFriendlyMessage",value:function(){switch(this.code){case ee.ENGINE_NOT_INITIALIZED:return"\u6D41\u7A0B\u5F15\u64CE\u672A\u6B63\u786E\u521D\u59CB\u5316\uFF0C\u8BF7\u68C0\u67E5\u914D\u7F6E";case ee.NODE_EXECUTION_FAILED:return"\u8282\u70B9\u6267\u884C\u5931\u8D25: ".concat(this.nodeId||"\u672A\u77E5\u8282\u70B9");case ee.NODE_PLUGIN_NOT_FOUND:return"\u8282\u70B9\u7C7B\u578B\u4E0D\u652F\u6301\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458";case ee.RULE_EVALUATION_FAILED:return"\u6761\u4EF6\u5224\u65AD\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u8F93\u5165\u6570\u636E";case ee.EVENT_EXECUTION_FAILED:return"\u64CD\u4F5C\u6267\u884C\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5";case ee.INSTANCE_NOT_FOUND:return"\u7EC4\u4EF6\u672A\u627E\u5230\uFF0C\u8BF7\u68C0\u67E5\u7EC4\u4EF6\u914D\u7F6E";case ee.INSTANCE_METHOD_NOT_FOUND:return"\u7EC4\u4EF6\u65B9\u6CD5\u4E0D\u53EF\u7528\uFF0C\u8BF7\u68C0\u67E5\u7EC4\u4EF6\u5B9E\u73B0";case ee.FLOW_DEFINITION_INVALID:return"\u6D41\u7A0B\u914D\u7F6E\u6709\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u6D41\u7A0B\u5B9A\u4E49";case ee.FLOW_TIMEOUT:return"\u64CD\u4F5C\u8D85\u65F6\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5";default:return"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u8054\u7CFB\u6280\u672F\u652F\u6301"}}}],[{key:"engineNotInitialized",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"\u5F15\u64CE\u672A\u521D\u59CB\u5316";return new e(n,ee.ENGINE_NOT_INITIALIZED,ne.HIGH)}},{key:"nodeExecutionFailed",value:function(n,u,a){return new e("\u8282\u70B9 ".concat(n," \u6267\u884C\u5931\u8D25: ").concat(u),ee.NODE_EXECUTION_FAILED,ne.HIGH,{nodeId:n,originalError:a})}},{key:"pluginNotFound",value:function(n){return new e("\u672A\u627E\u5230\u8282\u70B9\u7C7B\u578B ".concat(n," \u5BF9\u5E94\u7684\u63D2\u4EF6"),ee.NODE_PLUGIN_NOT_FOUND,ne.HIGH)}},{key:"ruleEvaluationFailed",value:function(n,u,a){return new e("\u8282\u70B9 ".concat(n," \u89C4\u5219\u8BC4\u4F30\u5931\u8D25: ").concat(u),ee.RULE_EVALUATION_FAILED,ne.MEDIUM,{nodeId:n,originalError:a})}},{key:"eventExecutionFailed",value:function(n,u,a,c){return new e("\u8282\u70B9 ".concat(n," \u4E8B\u4EF6 ").concat(u," \u6267\u884C\u5931\u8D25: ").concat(a),ee.EVENT_EXECUTION_FAILED,ne.MEDIUM,{nodeId:n,originalError:c})}},{key:"instanceNotFound",value:function(n){return new e("\u672A\u627E\u5230\u5B9E\u4F8B: ".concat(n),ee.INSTANCE_NOT_FOUND,ne.MEDIUM)}},{key:"methodNotFound",value:function(n,u){return new e("\u5B9E\u4F8B ".concat(n," \u4E2D\u672A\u627E\u5230\u65B9\u6CD5: ").concat(u),ee.INSTANCE_METHOD_NOT_FOUND,ne.MEDIUM)}},{key:"flowDefinitionInvalid",value:function(n){return new e("\u6D41\u7A0B\u5B9A\u4E49\u65E0\u6548: ".concat(n),ee.FLOW_DEFINITION_INVALID,ne.HIGH)}},{key:"timeout",value:function(n,u){return new e("\u8282\u70B9 ".concat(n," \u6267\u884C\u8D85\u65F6 (").concat(u,"ms)"),ee.FLOW_TIMEOUT,ne.HIGH,{nodeId:n})}}]),e}(gt()(Error)),Re=function(){function N(){$()(this,N),I()(this,"errorListeners",new Set)}return Z()(N,[{key:"handleError",value:function(e,r){var n;return e instanceof be?n=e:e instanceof Error?n=new be(e.message,ee.UNKNOWN_ERROR,ne.MEDIUM,{originalError:e,context:r}):n=new be(String(e),ee.UNKNOWN_ERROR,ne.MEDIUM,{context:r}),this.logError(n),this.notifyListeners(n),n}},{key:"addErrorListener",value:function(e){var r=this;return this.errorListeners.add(e),function(){return r.errorListeners.delete(e)}}},{key:"logError",value:function(e){var r=this.getLogLevel(e.severity),n="[".concat(e.code,"] ").concat(e.message),u={nodeId:e.nodeId,timestamp:e.timestamp,context:e.context,stack:e.stack};switch(r){case"error":console.error(n,u);break;case"warn":console.warn(n,u);break;case"info":console.info(n,u);break;default:console.log(n,u)}}},{key:"getLogLevel",value:function(e){switch(e){case ne.CRITICAL:case ne.HIGH:return"error";case ne.MEDIUM:return"warn";case ne.LOW:return"info";default:return"log"}}},{key:"notifyListeners",value:function(e){this.errorListeners.forEach(function(r){try{r(e)}catch(n){console.error("\u9519\u8BEF\u76D1\u542C\u5668\u6267\u884C\u5931\u8D25:",n)}})}}],[{key:"getInstance",value:function(){return N.instance||(N.instance=new N),N.instance}}]),N}();I()(Re,"instance",void 0);var xe=Re.getInstance(),Yt=function(){function N(){$()(this,N),I()(this,"startTime",null),I()(this,"endTime",null),I()(this,"nodeExecutionTimes",new Map),I()(this,"nodeExecutionCounts",new Map),I()(this,"nodeSuccessCounts",new Map),I()(this,"nodeFailureCounts",new Map),I()(this,"memorySnapshots",[]),I()(this,"peakMemory",0),I()(this,"nodeMetadata",new Map)}return Z()(N,[{key:"startMonitoring",value:function(e){this.startTime=new Date,this.endTime=null,this.resetMetrics(),this.takeMemorySnapshot(),console.log("[FlowMonitor] \u5F00\u59CB\u76D1\u63A7\u6D41\u7A0B: ".concat(e))}},{key:"stopMonitoring",value:function(e){this.endTime=new Date,this.takeMemorySnapshot();var r=this.generateReport(e);return console.log("[FlowMonitor] \u76D1\u63A7\u7ED3\u675F\uFF0C\u6D41\u7A0B: ".concat(e,"\uFF0C\u8017\u65F6: ").concat(r.duration,"ms")),r}},{key:"recordNodeExecution",value:function(e,r,n,u,a){if(u||a){var c,g=(c=this.nodeMetadata.get(e))!==null&&c!==void 0?c:{nodeName:"",pluginNodeType:""};this.nodeMetadata.set(e,{nodeName:u!=null?u:g.nodeName,pluginNodeType:a!=null?a:g.pluginNodeType})}this.nodeExecutionTimes.has(e)||this.nodeExecutionTimes.set(e,[]),this.nodeExecutionTimes.get(e).push(r);var t=this.nodeExecutionCounts.get(e)||0;if(this.nodeExecutionCounts.set(e,t+1),n===P.e4.SUCCESS){var i=this.nodeSuccessCounts.get(e)||0;this.nodeSuccessCounts.set(e,i+1)}else if(n===P.e4.FAILED){var o=this.nodeFailureCounts.get(e)||0;this.nodeFailureCounts.set(e,o+1)}}},{key:"getCurrentMetrics",value:function(){var e=0,r=0,n=0,u=0,a=null,c=null,g=-1/0,t=1/0,i=new Map;this.nodeExecutionTimes.forEach(function(p,h){var y=p.reduce(function(m,b){return m+b},0);i.set(h,y),e+=y,r++,y>g&&(g=y,a=h),y<t&&(t=y,c=h)}),this.nodeSuccessCounts.forEach(function(p){n+=p}),this.nodeFailureCounts.forEach(function(p){u+=p});var o=this.nodeExecutionCounts.size,s=o>0?e/o:0,l=n+u>0?u/(n+u)*100:0,d=n+u>0?n/(n+u)*100:0;return{totalExecutionTime:e,nodeExecutionTimes:i,averageNodeExecutionTime:s,slowestNode:a,fastestNode:c,successRate:d,failureRate:l,totalNodes:o,executedNodes:r,skippedNodes:o-r}}},{key:"getMemoryMetrics",value:function(){var e=this.getCurrentMemoryUsage(),r=this.peakMemory,n=this.detectMemoryLeaks(),u=this.memorySnapshots.length;return{usedMemory:e,peakMemory:r,memoryLeaks:n,garbageCollections:u}}},{key:"generateReport",value:function(e){var r=this.getCurrentMetrics(),n=this.getMemoryMetrics(),u=this.generateNodeStatistics(),a=this.generateRecommendations(r,n);return{flowId:e,startTime:this.startTime,endTime:this.endTime,duration:r.totalExecutionTime,status:this.determineOverallStatus(),performanceMetrics:r,memoryMetrics:n,nodeStatistics:u,recommendations:a}}},{key:"generateNodeStatistics",value:function(){var e=this,r=[];return this.nodeExecutionTimes.forEach(function(n,u){var a,c,g=n.reduce(function(y,m){return y+m},0),t=g/n.length,i=Math.min.apply(Math,Ce()(n)),o=Math.max.apply(Math,Ce()(n)),s=e.nodeExecutionCounts.get(u)||0,l=e.nodeSuccessCounts.get(u)||0,d=e.nodeFailureCounts.get(u)||0,p=s>0?l/s*100:0,h=e.nodeMetadata.get(u);r.push({nodeId:u,nodeName:(a=h==null?void 0:h.nodeName)!==null&&a!==void 0?a:u,pluginNodeType:(c=h==null?void 0:h.pluginNodeType)!==null&&c!==void 0?c:"",executionCount:s,totalExecutionTime:g,averageExecutionTime:t,successCount:l,failureCount:d,successRate:p,minExecutionTime:i,maxExecutionTime:o})}),r}},{key:"generateRecommendations",value:function(e,r){var n=[];e.averageNodeExecutionTime>1e3&&n.push("\u5E73\u5747\u8282\u70B9\u6267\u884C\u65F6\u95F4\u8FC7\u957F\uFF0C\u5EFA\u8BAE\u4F18\u5316\u8282\u70B9\u903B\u8F91"),e.failureRate>10&&n.push("\u8282\u70B9\u5931\u8D25\u7387\u8F83\u9AD8\uFF0C\u5EFA\u8BAE\u68C0\u67E5\u9519\u8BEF\u5904\u7406\u903B\u8F91"),e.slowestNode&&n.push("\u8282\u70B9 ".concat(e.slowestNode," \u6267\u884C\u65F6\u95F4\u6700\u957F\uFF0C\u5EFA\u8BAE\u91CD\u70B9\u4F18\u5316")),r.memoryLeaks>0&&n.push("\u68C0\u6D4B\u5230\u6F5C\u5728\u5185\u5B58\u6CC4\u6F0F\uFF0C\u5EFA\u8BAE\u68C0\u67E5\u8D44\u6E90\u6E05\u7406\u903B\u8F91");var u=this.memorySnapshots.slice(-10),a=this.calculateTrend(u);return a>0?n.push("\u5185\u5B58\u4F7F\u7528\u5448\u4E0A\u5347\u8D8B\u52BF\uFF0C\u5EFA\u8BAE\u4F18\u5316\u5185\u5B58\u7BA1\u7406"):a<0&&n.push("\u5185\u5B58\u4F7F\u7528\u5448\u4E0B\u964D\u8D8B\u52BF"),n}},{key:"determineOverallStatus",value:function(){var e=Array.from(this.nodeExecutionCounts.values()).reduce(function(u,a){return u+a},0),r=Array.from(this.nodeFailureCounts.values()).reduce(function(u,a){return u+a},0),n=Array.from(this.nodeSuccessCounts.values()).reduce(function(u,a){return u+a},0);return r>0?P.e4.FAILED:n===e&&e>0?P.e4.SUCCESS:P.e4.PENDING}},{key:"resetMetrics",value:function(){this.nodeExecutionTimes.clear(),this.nodeExecutionCounts.clear(),this.nodeSuccessCounts.clear(),this.nodeFailureCounts.clear(),this.memorySnapshots=[],this.peakMemory=0,this.nodeMetadata.clear()}},{key:"takeMemorySnapshot",value:function(){var e=this.getCurrentMemoryUsage();this.memorySnapshots.push(e),e>this.peakMemory&&(this.peakMemory=e)}},{key:"getCurrentMemoryUsage",value:function(){return Math.random()*100}},{key:"detectMemoryLeaks",value:function(){for(var e=0,r=1;r<this.memorySnapshots.length;r++)this.memorySnapshots[r]>this.memorySnapshots[r-1]*1.5&&e++;return e}},{key:"calculateTrend",value:function(e){if(e.length<2)return 0;for(var r=0,n=1;n<e.length;n++)r+=e[n]-e[n-1];return r}}]),N}(),$e=new Yt,Jt=function(){function N(){$()(this,N)}return Z()(N,[{key:"validate",value:function(e){var r=[],n=[];return this.validateBasicStructure(e,r,n),this.validateNodes(e,r,n),this.validateEdges(e,r,n),this.validateFlowLogic(e,r,n),{isValid:r.length===0,errors:r,warnings:n}}},{key:"validateBasicStructure",value:function(e,r,n){var u,a;(u=e.flow)!==null&&u!==void 0&&u.id||r.push({code:"MISSING_FLOW_ID",message:"\u6D41\u7A0BID\u4E0D\u80FD\u4E3A\u7A7A",severity:"error"}),(a=e.flow)!==null&&a!==void 0&&a.name||r.push({code:"MISSING_FLOW_NAME",message:"\u6D41\u7A0B\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",severity:"error"}),(!Array.isArray(e.nodes)||e.nodes.length===0)&&r.push({code:"MISSING_NODES",message:"\u6D41\u7A0B\u5FC5\u987B\u5305\u542B\u81F3\u5C11\u4E00\u4E2A\u8282\u70B9",severity:"error"}),Array.isArray(e.edges)||r.push({code:"MISSING_EDGES",message:"\u6D41\u7A0B\u8FB9\u5B9A\u4E49\u4E0D\u80FD\u4E3A\u7A7A",severity:"error"})}},{key:"validateNodes",value:function(e,r,n){var u=new Set,a=[],c=[],g=te()(e.nodes),t;try{for(g.s();!(t=g.n()).done;){var i,o,s,l=t.value;u.has(l.id)?r.push({code:"DUPLICATE_NODE_ID",message:"\u8282\u70B9ID\u91CD\u590D: ".concat(l.id),nodeId:l.id,severity:"error"}):u.add(l.id),(i=l.data)!==null&&i!==void 0&&i.name||r.push({code:"MISSING_NODE_NAME",message:"\u8282\u70B9 ".concat(l.id," \u7F3A\u5C11\u540D\u79F0"),nodeId:l.id,severity:"error"}),((o=l.data)===null||o===void 0?void 0:o.pluginNodeType)==="Trigger"?a.push(l):((s=l.data)===null||s===void 0?void 0:s.pluginNodeType)==="End"&&c.push(l),this.validateNodeConfig(l,r,n)}}catch(d){g.e(d)}finally{g.f()}a.length===0?r.push({code:"MISSING_TRIGGER_NODE",message:"\u6D41\u7A0B\u5FC5\u987B\u5305\u542B\u81F3\u5C11\u4E00\u4E2A\u89E6\u53D1\u5668\u8282\u70B9",severity:"error"}):a.length>1&&n.push({code:"MULTIPLE_TRIGGER_NODES",message:"\u53D1\u73B0\u591A\u4E2A\u89E6\u53D1\u5668\u8282\u70B9: ".concat(a.map(function(d){return d.id}).join(", "))}),c.length===0&&n.push({code:"MISSING_END_NODE",message:"\u5EFA\u8BAE\u6D41\u7A0B\u5305\u542B\u81F3\u5C11\u4E00\u4E2A\u7ED3\u675F\u8282\u70B9"})}},{key:"validateNodeConfig",value:function(e,r,n){var u,a;if(((u=e.data)===null||u===void 0?void 0:u.pluginNodeType)==="Iteration"){var c,g=(c=e.data)===null||c===void 0||(c=c.config)===null||c===void 0?void 0:c.iteration_count;g!==void 0&&(g<1||g>100)&&r.push({code:"INVALID_ITERATION_COUNT",message:"\u8282\u70B9 ".concat(e.id," \u7684\u8FED\u4EE3\u6B21\u6570\u5FC5\u987B\u57281-100\u4E4B\u95F4"),nodeId:e.id,severity:"error"})}if(((a=e.data)===null||a===void 0?void 0:a.pluginNodeType)==="Parallel"){var t,i=(t=e.data)===null||t===void 0||(t=t.config)===null||t===void 0?void 0:t.parallel_strategy;i&&!["all","any"].includes(i)&&r.push({code:"INVALID_PARALLEL_STRATEGY",message:"\u8282\u70B9 ".concat(e.id," \u7684\u5E76\u884C\u7B56\u7565\u65E0\u6548"),nodeId:e.id,severity:"error"})}}},{key:"validateEdges",value:function(e,r,n){var u=new Set(e.nodes.map(function(i){return i.id})),a=new Set,c=te()(e.edges),g;try{for(c.s();!(g=c.n()).done;){var t=g.value;a.has(t.id)?r.push({code:"DUPLICATE_EDGE_ID",message:"\u8FB9ID\u91CD\u590D: ".concat(t.id),edgeId:t.id,severity:"error"}):a.add(t.id),u.has(t.source)||r.push({code:"INVALID_SOURCE_NODE",message:"\u8FB9 ".concat(t.id," \u7684\u6E90\u8282\u70B9\u4E0D\u5B58\u5728: ").concat(t.source),edgeId:t.id,severity:"error"}),u.has(t.target)||r.push({code:"INVALID_TARGET_NODE",message:"\u8FB9 ".concat(t.id," \u7684\u76EE\u6807\u8282\u70B9\u4E0D\u5B58\u5728: ").concat(t.target),edgeId:t.id,severity:"error"}),t.source===t.target&&n.push({code:"SELF_LOOP_EDGE",message:"\u8FB9 ".concat(t.id," \u5B58\u5728\u81EA\u5FAA\u73AF"),edgeId:t.id})}}catch(i){c.e(i)}finally{c.f()}}},{key:"validateFlowLogic",value:function(e,r,n){this.checkCircularDependency(e,r),this.checkOrphanedNodes(e,n),this.checkUnreachableNodes(e,n)}},{key:"checkCircularDependency",value:function(e,r){var n=new Set,u=new Set,a=function i(o){if(u.has(o))return!0;if(n.has(o))return!1;n.add(o),u.add(o);var s=e.edges.filter(function(h){return h.source===o}),l=te()(s),d;try{for(l.s();!(d=l.n()).done;){var p=d.value;if(i(p.target))return!0}}catch(h){l.e(h)}finally{l.f()}return u.delete(o),!1},c=te()(e.nodes),g;try{for(c.s();!(g=c.n()).done;){var t=g.value;if(!n.has(t.id)&&a(t.id)){r.push({code:"CIRCULAR_DEPENDENCY",message:"\u6D41\u7A0B\u4E2D\u5B58\u5728\u5FAA\u73AF\u4F9D\u8D56",nodeId:t.id,severity:"error"});break}}}catch(i){c.e(i)}finally{c.f()}}},{key:"checkOrphanedNodes",value:function(e,r){var n=new Set,u=te()(e.edges),a;try{for(u.s();!(a=u.n()).done;){var c=a.value;n.add(c.source),n.add(c.target)}}catch(o){u.e(o)}finally{u.f()}var g=te()(e.nodes),t;try{for(g.s();!(t=g.n()).done;){var i=t.value;n.has(i.id)||r.push({code:"ORPHANED_NODE",message:"\u8282\u70B9 ".concat(i.id," \u6CA1\u6709\u8FDE\u63A5\u4EFB\u4F55\u8FB9"),nodeId:i.id})}}catch(o){g.e(o)}finally{g.f()}}},{key:"checkUnreachableNodes",value:function(e,r){var n=e.nodes.filter(function(l){return l.type==="Trigger"});if(n.length!==0){var u=new Set,a=function l(d){if(!u.has(d)){u.add(d);var p=e.edges.filter(function(b){return b.source===d}),h=te()(p),y;try{for(h.s();!(y=h.n()).done;){var m=y.value;l(m.target)}}catch(b){h.e(b)}finally{h.f()}}},c=te()(n),g;try{for(c.s();!(g=c.n()).done;){var t=g.value;a(t.id)}}catch(l){c.e(l)}finally{c.f()}var i=te()(e.nodes),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;u.has(s.id)||r.push({code:"UNREACHABLE_NODE",message:"\u8282\u70B9 ".concat(s.id," \u4ECE\u89E6\u53D1\u5668\u8282\u70B9\u4E0D\u53EF\u8FBE"),nodeId:s.id})}}catch(l){i.e(l)}finally{i.f()}}}},{key:"validateAndThrow",value:function(e){var r=this.validate(e);if(!r.isValid){var n=r.errors.map(function(u){return u.message}).join("; ");throw be.flowDefinitionInvalid(n)}}}]),N}(),Qt=new Jt,ze=function(){function N(){$()(this,N),I()(this,"flow",null),I()(this,"nodes",{}),I()(this,"executionHistory",[]),I()(this,"hasFailed",!1),I()(this,"currentHistoryItem",null),I()(this,"eventListeners",new Map),I()(this,"nodeCache",new Map),I()(this,"edgeCache",new Map),I()(this,"contextManager",void 0),I()(this,"componentManager",void 0),I()(this,"pluginManager",void 0),this.contextManager=new Xt,this.componentManager=Ze.getInstance(),this.pluginManager=T.getInstance()}return Z()(N,[{key:"on",value:function(e,r){var n;this.eventListeners.has(e)||this.eventListeners.set(e,[]),(n=this.eventListeners.get(e))===null||n===void 0||n.push(r)}},{key:"off",value:function(e,r){var n=this.eventListeners.get(e);if(n){var u=n.indexOf(r);u!==-1&&n.splice(u,1)}}},{key:"emit",value:function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),u=1;u<r;u++)n[u-1]=arguments[u];var a=this.eventListeners.get(e);a&&a.forEach(function(c){try{c.apply(void 0,n)}catch(g){console.error("\u6267\u884C\u4E8B\u4EF6\u76D1\u542C\u5668\u65F6\u51FA\u9519:",g)}})}},{key:"getContext",value:function(){try{return this.contextManager.getContext()}catch(e){return console.error("\u83B7\u53D6\u4E0A\u4E0B\u6587\u5931\u8D25\uFF1A",e),null}}},{key:"setHasFailed",value:function(e){this.hasFailed=e}},{key:"updateContext",value:function(e){this.contextManager.updateContext(e)}},{key:"getContextManager",value:function(){return this.contextManager}},{key:"getNodes",value:function(){return this.flow?Ce()(this.flow.nodes):[]}},{key:"getNode",value:function(e){if(!this.flow)return[];if(!e)return Ce()(this.flow.nodes);if(this.nodeCache.has(e))return this.nodeCache.get(e);var r=this.nodes[e];return r&&this.nodeCache.set(e,r),r}},{key:"getEdges",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:P.Pb.ALL;if(!this.flow)return[];var n="".concat(e,"_").concat(r);if(this.edgeCache.has(n))return this.edgeCache.get(n);var u;switch(r){case P.Pb.INCOMING:u=this.flow.edges.filter(function(a){return a.target===e});break;case P.Pb.OUTGOING:u=this.flow.edges.filter(function(a){return a.source===e});break;case P.Pb.ALL:default:u=this.flow.edges.filter(function(a){return a.source===e||a.target===e});break}return this.edgeCache.set(n,u),u}},{key:"getIncomingEdges",value:function(e){return this.getEdges(e,P.Pb.INCOMING)}},{key:"getOutgoingEdges",value:function(e){return this.getEdges(e,P.Pb.OUTGOING)}},{key:"getComponentManager",value:function(){return this.componentManager}},{key:"getPluginManager",value:function(){return this.pluginManager}},{key:"createEngine",value:function(){var e=new ct.Engine;return Pe(e),e}},{key:"collectConditionFacts",value:function(e){var r=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;if(!e||Ie()(e)!=="object")return n;var u=Array.isArray(e)?e:[].concat(Ce()(e.all||[]),Ce()(e.any||[]));return u.forEach(function(a){a&&(typeof a.fact=="string"&&n.add(a.fact),(a.all||a.any)&&r.collectConditionFacts(a,n))}),n}},{key:"evaluateRule",value:function(){var v=O()(f()().mark(function r(n,u){var a,c,g,t,i,o,s;return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(n){d.next=2;break}return d.abrupt("return",!0);case 2:return a=this.createEngine(),d.prev=3,c=this.contextManager.getVariables(),g=this.collectConditionFacts(n),t=z()({},c),g.forEach(function(p){Object.prototype.hasOwnProperty.call(t,p)||(t[p]=null)}),console.log("[PluginExecutionEngine] \u8BC4\u4F30\u89C4\u5219 ".concat(u,":"),n),console.log("[PluginExecutionEngine] \u5F53\u524D\u53D8\u91CF:",c),console.log("[PluginExecutionEngine] \u5F52\u4E00\u5316\u53D8\u91CF:",t),a.addRule({conditions:n,event:{type:"match"}}),d.next=14,a.run(t);case 14:return i=d.sent,o=i.events.some(function(p){return p.type==="match"}),console.log("[PluginExecutionEngine] \u89C4\u5219 ".concat(u," \u8BC4\u4F30\u7ED3\u679C:"),o),console.log("[PluginExecutionEngine] \u5F15\u64CE\u7ED3\u679C:",i),console.log("[PluginExecutionEngine] \u5339\u914D\u7684\u4E8B\u4EF6:",i.events),d.abrupt("return",o);case 22:throw d.prev=22,d.t0=d.catch(3),console.log("[PluginExecutionEngine] \u89C4\u5219 ".concat(u," \u8BC4\u4F30\u5F02\u5E38:"),d.t0),this.hasFailed=!0,s=be.ruleEvaluationFailed(u||"unknown",d.t0 instanceof Error?d.t0.message:String(d.t0),d.t0 instanceof Error?d.t0:void 0),xe.handleError(s);case 28:case"end":return d.stop()}},r,this,[[3,22]])}));function e(r,n){return v.apply(this,arguments)}return e}()},{key:"evaluateMethod",value:function(){var v=O()(f()().mark(function r(n,u){var a,c;return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(!n||Object.keys(n).length===0)){t.next=2;break}return t.abrupt("return",!0);case 2:if(n.type){t.next=4;break}return t.abrupt("return",!1);case 4:return t.prev=4,t.next=7,this.componentManager.callMethod(n.type,n.params);case 7:return a=t.sent,a&&Ie()(a)==="object"&&this.contextManager.updateVariables(a),t.abrupt("return",a);case 12:throw t.prev=12,t.t0=t.catch(4),c=be.eventExecutionFailed(u||"unknown",n.type,t.t0 instanceof Error?t.t0.message:String(t.t0),t.t0 instanceof Error?t.t0:void 0),this.currentHistoryItem&&(this.currentHistoryItem.eventResult=c.message,this.currentHistoryItem.engineResult=c.message),this.hasFailed=!0,xe.handleError(c);case 18:case"end":return t.stop()}},r,this,[[4,12]])}));function e(r,n){return v.apply(this,arguments)}return e}()},{key:"initialize",value:function(e,r){var n=z()(z()({},e),{},{nodes:(e.nodes||[]).map(function(u){var a,c,g,t=z()({},u.data),i=(a=(c=(g=t==null?void 0:t.name)!==null&&g!==void 0?g:t==null?void 0:t.label)!==null&&c!==void 0?c:t==null?void 0:t.pluginNodeType)!==null&&a!==void 0?a:u.id;return z()(z()({},u),{},{data:z()(z()({},t),{},{name:i})})}),edges:e.edges||[]});try{Qt.validateAndThrow(n)}catch(u){throw xe.handleError(u)}this.flow=n,this.contextManager.initialize(z()({},r)),this.executionHistory=[],this.hasFailed=!1,this.nodeCache.clear(),this.edgeCache.clear(),this.nodes=n.nodes.reduce(function(u,a){return u[a.id]=a,u},{})}},{key:"getExecutionHistory",value:function(){return Ce()(this.executionHistory)}},{key:"getNextNodeId",value:function(){var v=O()(f()().mark(function r(n,u){var a,c,g,t;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(this.flow){o.next=2;break}return o.abrupt("return",null);case 2:if(c=this.nodes[n],c){o.next=5;break}return o.abrupt("return",null);case 5:if(g=this.getOutgoingEdges(c.id),t=this.pluginManager.getPlugin((a=c.data)===null||a===void 0?void 0:a.pluginNodeType),!t){o.next=11;break}return o.next=10,t.getNextNodeId(g,this,u);case 10:return o.abrupt("return",o.sent);case 11:return o.abrupt("return",null);case 12:case"end":return o.stop()}},r,this)}));function e(r,n){return v.apply(this,arguments)}return e}()},{key:"getNodeStatus",value:function(){var v=O()(f()().mark(function r(n){var u,a,c;return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(!this.flow||!this.nodes[n])){t.next=2;break}return t.abrupt("return",null);case 2:if(a=this.nodes[n],c=this.pluginManager.getPlugin((u=a.data)===null||u===void 0?void 0:u.pluginNodeType),!c){t.next=8;break}return t.next=7,c.getExecuteNodeStatus(a,this);case 7:return t.abrupt("return",t.sent);case 8:return t.abrupt("return",null);case 9:case"end":return t.stop()}},r,this)}));function e(r){return v.apply(this,arguments)}return e}()},{key:"executeFlow",value:function(){var v=O()(f()().mark(function r(){var n,u,a,c,g,t,i=arguments;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(n=i.length>0&&i[0]!==void 0?i[0]:"trigger",this.flow){s.next=3;break}return s.abrupt("return",{status:!1,message:"\u5F15\u64CE\u672A\u521D\u59CB\u5316\uFF0C\u8BF7\u5148\u8C03\u7528initialize\u65B9\u6CD5"});case 3:return $e.startMonitoring(this.flow.flow.id),this.executionHistory=[],this.hasFailed=!1,s.prev=6,s.next=9,this.executeNode(n);case 9:return u=this.checkForFailedNodes(),a=$e.stopMonitoring(this.flow.flow.id),c={status:!u,message:u?"\u6D41\u7A0B\u6267\u884C\u5931\u8D25":"\u6D41\u7A0B\u6267\u884C\u5B8C\u6210",variables:this.contextManager.getVariables(),errorInfo:u?this.findLatestFailedNode():void 0,executionReport:a},this.emit("flow_completed",c),s.abrupt("return",c);case 16:return s.prev=16,s.t0=s.catch(6),g=$e.stopMonitoring(this.flow.flow.id),t={status:!1,message:"\u6D41\u7A0B\u6267\u884C\u5931\u8D25",variables:this.contextManager.getVariables(),errorInfo:{error:s.t0 instanceof Error?s.t0.message:String(s.t0),timestamp:new Date().toISOString()},executionReport:g},this.emit("flow_completed",t),s.abrupt("return",t);case 22:case"end":return s.stop()}},r,this,[[6,16]])}));function e(){return v.apply(this,arguments)}return e}()},{key:"executeNode",value:function(){var v=O()(f()().mark(function r(n){var u,a,c,g,t,i,o,s,l,d,p,h,y,m,b;return f()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!(!this.flow||!this.nodes[n])){w.next=3;break}return this.hasFailed=!0,w.abrupt("return",!1);case 3:if(a=this.nodes[n],c=this.pluginManager.getPlugin((u=a.data)===null||u===void 0?void 0:u.pluginNodeType),c){w.next=8;break}throw t=be.pluginNotFound(((g=a.data)===null||g===void 0?void 0:g.pluginNodeType)||"unknown"),xe.handleError(t);case 8:return w.prev=8,w.next=11,c.shouldExecuteNode(a,this);case 11:if(p=w.sent,p){w.next=15;break}return console.log("\u8282\u70B9 ".concat(a.id," \u88AB\u8DF3\u8FC7\uFF0C\u4E0D\u6EE1\u8DB3\u6267\u884C\u6761\u4EF6")),w.abrupt("return",!1);case 15:return h={nodeId:a.id,nodeName:(i=(o=a.data)===null||o===void 0?void 0:o.name)!==null&&i!==void 0?i:a.id,nodeType:a.type,pluginNodeType:(s=a.data)===null||s===void 0?void 0:s.pluginNodeType,status:P.e4.PENDING,startTime:new Date,timestamp:new Date,contextBefore:z()({},this.contextManager.getVariables()),conditions:(l=a.data)===null||l===void 0||(l=l.config)===null||l===void 0?void 0:l.conditions,eventResult:void 0,engineResult:void 0},(d=a.data)!==null&&d!==void 0&&(d=d.config)!==null&&d!==void 0&&d.event&&(h.event=(y=a.data)===null||y===void 0||(y=y.config)===null||y===void 0?void 0:y.event),this.currentHistoryItem=h,w.next=20,c.executeNode(a,this,h);case 20:return m=w.sent,h.startTime&&h.endTime&&(b=h.endTime.getTime()-h.startTime.getTime(),$e.recordNodeExecution(a.id,b,h.status,h.nodeName,h.pluginNodeType)),this.executionHistory.push(h),this.emit("history_updated",this.getExecutionHistory()),this.emit("node_executed",h),w.next=27,c.onNodeComplete(a,this,h,m);case 27:return w.abrupt("return",m);case 30:return w.prev=30,w.t0=w.catch(8),this.currentHistoryItem&&this.handleExecutionError(this.currentHistoryItem,w.t0),this.hasFailed=!0,w.abrupt("return",!1);case 35:return w.prev=35,this.currentHistoryItem=null,w.finish(35);case 38:case"end":return w.stop()}},r,this,[[8,30,35,38]])}));function e(r){return v.apply(this,arguments)}return e}()},{key:"handleExecutionError",value:function(e,r){console.error("\u6267\u884C\u8282\u70B9 ".concat(e.nodeName," \u65F6\u53D1\u751F\u9519\u8BEF:"),r);var n=r instanceof Error?r.message:String(r);e.event&&(e.eventResult=n),e.status=P.e4.FAILED,e.endTime=new Date,e.duration=e.startTime?e.endTime.getTime()-e.startTime.getTime():0,e.contextAfter=z()({},this.contextManager.getVariables()),e.engineResult=n,this.executionHistory.some(function(u){return u.nodeId===e.nodeId&&u.timestamp.getTime()===e.timestamp.getTime()})||(this.executionHistory.push(e),this.emit("history_updated",this.getExecutionHistory()),this.emit("node_executed",e))}},{key:"checkForFailedNodes",value:function(){return this.executionHistory.some(function(e){return e.status===P.e4.FAILED})}},{key:"findLatestFailedNode",value:function(){var e=this.executionHistory.filter(function(r){return r.status===P.e4.FAILED});if(e.length!==0)return e.reduce(function(r,n){return n.timestamp.getTime()>r.timestamp.getTime()?n:r})}},{key:"dispose",value:function(){try{this.eventListeners.clear(),this.nodeCache.clear(),this.edgeCache.clear(),this.executionHistory=[],this.currentHistoryItem=null,this.hasFailed=!1,this.flow=null,this.nodes={}}catch(e){console.error("\u6E05\u7406PluginExecutionEngine\u8D44\u6E90\u65F6\u51FA\u9519:",e)}}}]),N}(),gn=null,qt=function(v){var e,r=(0,ie.useState)(null),n=ye()(r,2),u=n[0],a=n[1],c=(0,ie.useState)(null),g=ye()(c,2),t=g[0],i=g[1],o=(0,ie.useState)([]),s=ye()(o,2),l=s[0],d=s[1],p=(0,ie.useState)(!1),h=ye()(p,2),y=h[0],m=h[1],b=v.flowData,A=v.initialVariables,w=A===void 0?{}:A,D=v.components,M=D===void 0?[]:D,F=(0,ie.useRef)(new Set);(0,ie.useEffect)(function(){H.current=!1,F.current.clear();try{var R;if(!b||!b.flow||!Array.isArray(b.nodes)){console.warn("\u65E0\u6548\u7684\u6D41\u7A0B\u5B9A\u4E49\u6570\u636E\uFF0C\u5FC5\u987B\u5305\u542Bflow\u548Cnodes\u5C5E\u6027");return}var x=(R=b.context)!==null&&R!==void 0&&R.variables?Object.keys(b.context.variables).reduce(function(U,re){var ae,oe=b.context.variables[re];return U[re]=(ae=oe.default)!==null&&ae!==void 0?ae:null,U},{}):{},V=z()(z()({},x),w),B={variables:V},X=new ze;return X.initialize(b,B),a(X),function(){try{X&&typeof X.dispose=="function"&&X.dispose()}catch(U){console.error("\u6E05\u7406\u5F15\u64CE\u8D44\u6E90\u65F6\u51FA\u9519:",U)}}}catch(U){console.error("\u521D\u59CB\u5316\u6D41\u7A0B\u5F15\u64CE\u65F6\u51FA\u9519:",U),a(null)}},[b,w]),(0,ie.useEffect)(function(){if(!(!u||M.length===0))try{var R=u.getComponentManager(),x=M.filter(function(B){var X;return((X=B.ref)===null||X===void 0?void 0:X.current)&&typeof B.name=="string"}),V=x.filter(function(B){return!F.current.has(B.name)});return V.length>0&&V.forEach(function(B){R.registerInstance(B.name,B.ref),F.current.add(B.name)}),function(){var B=M.map(function(U){return U.name}),X=Array.from(F.current).filter(function(U){return!B.includes(U)});X.length>0&&R&&(R.unregisterInstances(X),X.forEach(function(U){F.current.delete(U)}))}}catch(B){console.error("\u6CE8\u518C\u7EC4\u4EF6\u5B9E\u4F8B\u65F6\u51FA\u9519:",B)}},[u,M]),(0,ie.useEffect)(function(){if(u)try{var R=function(V){d(V)};return u.on("history_updated",R),function(){u&&u.off("history_updated",R)}}catch(x){console.error("\u8BBE\u7F6E\u5386\u53F2\u8BB0\u5F55\u76D1\u542C\u5668\u65F6\u51FA\u9519:",x)}},[u]);var C=(0,ie.useCallback)(O()(f()().mark(function R(){var x,V,B,X,U,re,ae,oe;return f()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(u){S.next=4;break}throw x=new Error("\u5F15\u64CE\u672A\u521D\u59CB\u5316"),console.error(x),x;case 4:if(m(!0),i(null),d([]),S.prev=7,V=u.getContextManager(),V){S.next=11;break}throw new Error("\u4E0A\u4E0B\u6587\u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316");case 11:return B=V.getVariables(),X=V.getContext(),u.updateContext(X),S.next=17,u.executeFlow();case 17:U=S.sent,re=u.getExecutionHistory(),d(re),i(U),S.next=30;break;case 24:S.prev=24,S.t0=S.catch(7),console.error("\u6267\u884C\u6D41\u7A0B\u65F6\u51FA\u9519:",S.t0),ae=u.getExecutionHistory(),d(ae);try{oe=u.getContextManager(),i({status:!1,message:"\u6D41\u7A0B\u6267\u884C\u5931\u8D25",variables:oe?oe.getVariables():{},errorInfo:{error:S.t0 instanceof Error?S.t0.message:String(S.t0),timestamp:new Date().toISOString()}})}catch(ge){console.error("\u8BBE\u7F6E\u6267\u884C\u7ED3\u679C\u65F6\u51FA\u9519:",ge),i({status:!1,message:"\u6D41\u7A0B\u6267\u884C\u5931\u8D25\u4E14\u65E0\u6CD5\u83B7\u53D6\u4E0A\u4E0B\u6587\u4FE1\u606F",variables:{},errorInfo:{error:S.t0 instanceof Error?S.t0.message:String(S.t0),innerError:ge instanceof Error?ge.message:String(ge),timestamp:new Date().toISOString()}})}case 30:return S.prev=30,m(!1),S.finish(30);case 33:case"end":return S.stop()}},R,null,[[7,24,30,33]])})),[u]),G=(0,ie.useCallback)(function(R){if(!u){console.warn("\u5F15\u64CE\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u66F4\u65B0\u53D8\u91CF");return}try{var x=u.getContextManager();if(!x){console.warn("\u4E0A\u4E0B\u6587\u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u66F4\u65B0\u53D8\u91CF");return}if(!R||Ie()(R)!=="object"){console.warn("\u65E0\u6548\u7684\u53D8\u91CF\u53C2\u6570\uFF0C\u5FC5\u987B\u662F\u5BF9\u8C61\u7C7B\u578B");return}x.updateVariables(R)}catch(V){console.error("\u66F4\u65B0\u4E0A\u4E0B\u6587\u53D8\u91CF\u65F6\u51FA\u9519:",V)}},[u]),H=(0,ie.useRef)(!1);return(0,ie.useEffect)(function(){var R;if(!(!u||!(b!=null&&(R=b.flow)!==null&&R!==void 0&&R.auto)||H.current)){var x=function(){var B=O()(f()().mark(function X(){var U,re,ae,oe;return f()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(S.prev=0,U=M.every(function(ge){var je;return((je=ge.ref)===null||je===void 0?void 0:je.current)&&F.current.has(ge.name)}),!(U&&!y)){S.next=20;break}if(S.prev=3,re=u.getContextManager(),re){S.next=7;break}throw new Error("\u4E0A\u4E0B\u6587\u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316");case 7:return ae=re.getContext(),u.updateContext(ae),H.current=!0,S.next=13,C();case 13:S.next=18;break;case 15:S.prev=15,S.t0=S.catch(3),console.error("\u81EA\u52A8\u6267\u884C\u6D41\u7A0B\u5931\u8D25:",S.t0);case 18:S.next=24;break;case 20:if(U){S.next=24;break}return oe=setTimeout(x,500),S.abrupt("return",function(){return clearTimeout(oe)});case 24:S.next=29;break;case 26:S.prev=26,S.t1=S.catch(0),console.error("\u81EA\u52A8\u6267\u884C\u6D41\u7A0B\u903B\u8F91\u51FA\u9519:",S.t1);case 29:case"end":return S.stop()}},X,null,[[0,26],[3,15]])}));return function(){return B.apply(this,arguments)}}(),V=setTimeout(x,300);return function(){return clearTimeout(V)}}},[u,b==null||(e=b.flow)===null||e===void 0?void 0:e.auto,M,y]),{engine:u,executeFlow:C,executionResult:t,executionHistory:l,isExecuting:y,updateVariables:G}}},23536:function(ht,Ee,E){E.d(Ee,{Dj:function(){return O},FR:function(){return De},Pb:function(){return Ue},e4:function(){return f},jc:function(){return Ge}});var De={Trigger:"Trigger",Action:"Action",Branch:"Branch",Parallel:"Parallel",Iteration:"Iteration",Merge:"Merge",End:"End"},f=function($){return $.PENDING="pending",$.RUNNING="running",$.SUCCESS="success",$.FAILED="failed",$}({}),Ue=function($){return $.INCOMING="in",$.OUTGOING="out",$.ALL="all",$}({}),O=function($){return $.ALL="all",$.ANY="any",$}({}),Ge=function($){return $[$.ALL_SUCCESS=1]="ALL_SUCCESS",$[$.ANY_SUCCESS=2]="ANY_SUCCESS",$[$.ANY_FAILURE=3]="ANY_FAILURE",$}({})},14849:function(ht,Ee,E){E.d(Ee,{P:function(){return De}});var De={Input:"ant_Input",InputPassword:"ant_Input.Password",InputTextArea:"ant_Input.TextArea",InputSearch:"ant_Input.Search",InputNumber:"ant_InputNumber",Select:"ant_Select",Checkbox:"ant_Checkbox",CheckboxGroup:"ant_Checkbox.Group",RadioGroup:"ant_Radio.Group",Switch:"ant_Switch",DatePicker:"ant_DatePicker",DatePickerRangePicker:"ant_DatePicker.RangePicker",TimePicker:"ant_TimePicker",Slider:"ant_Slider",Cascader:"ant_Cascader",TreeSelect:"ant_TreeSelect",Rate:"ant_Rate",AutoComplete:"ant_AutoComplete",Mentions:"ant_Mentions",Upload:"ant_Upload",Transfer:"ant_Transfer",ColorPicker:"ant_ColorPicker"}},95257:function(ht,Ee,E){E.r(Ee),E.d(Ee,{AntdWidgetKeys:function(){return Xt.P},DynamicConfigForm:function(){return dt},FlowView:function(){return g},bindPluginsToUI:function(){return Kt},getNodeSchemas:function(){return We},getWidgetByType:function(){return ct},getWidgets:function(){return Ce},injectNodeSchema:function(){return Le},injectWidget:function(){return Ie},registerNodeSchema:function(){return cn},registerPluginUI:function(){return dn},resolveNodeFormConfig:function(){return vt}});var De=E(73193),f=E.n(De),Ue=E(90819),O=E.n(Ue),Ge=E(89933),$=E.n(Ge),pt=E(45332),Z=E.n(pt),L=E(44194),I=E(92489),pe=E(68493),Q=E(1617),ke=E(24596),ce=E(84176),Y=E.n(ce),de=E(86222),mt=E.n(de),me=E(78796),Xe=E.n(me),Ne=E(4977),Ye=E.n(Ne),te=E(10154),j=E.n(te),z=E(97089),P=E(95133),ve=E(42663),He=E(5303),Ve=E(6958),Nt=E(25606),Je=E(65275),yt=E(60999),Et=E(11252),Qe=E(92178),qe=E(9537),Ct=E(31889),bt=E(76950),Ft=E(70966),wt=E(49345),_e=E(8112),et=E(92414),Be,kt=["value","onChange"],It=["value","onChange"],St=["value","onChange"],tt=["value","onChange"],nt=["value","onChange"],Dt=["value","onChange","options"],Tt=["value","onChange"],At=["value","onChange","options"],Pt=["value","onChange","options"],rt=["value","onChange"],at=["value","onChange"],Mt=["value","onChange"],Bt=["value","onChange"],Ot=["value","onChange"],Lt=["value","onChange","options"],ut=["value","onChange"],it=["value","onChange"],Rt=["value","onChange","options"],xt=["value","onChange"],$t=["value","onChange"],jt=["value","onChange","dataSource"],st=["value","onChange"],q="ant_",Ut=(Be={},j()(j()(j()(j()(j()(j()(j()(j()(j()(j()(Be,q+"Input",function(t){var i=t.value,o=t.onChange,s=Y()(t,kt);return L.createElement(z.Z,f()({value:i,onChange:function(d){return o(d.target.value)}},s))}),q+"Input.Password",function(t){var i=t.value,o=t.onChange,s=Y()(t,It);return L.createElement(z.Z.Password,f()({value:i,onChange:function(d){return o(d.target.value)}},s))}),q+"Input.TextArea",function(t){var i=t.value,o=t.onChange,s=Y()(t,St);return L.createElement(z.Z.TextArea,f()({value:i,onChange:function(d){return o(d.target.value)}},s))}),q+"Input.Search",function(t){var i=t.value,o=t.onChange,s=Y()(t,tt);return L.createElement(z.Z.Search,f()({value:i,onChange:function(d){return o(d.target.value)},onSearch:function(d){return o(d)}},s))}),q+"InputNumber",function(t){var i=t.value,o=t.onChange,s=Y()(t,nt);return L.createElement(P.Z,f()({value:i,onChange:function(d){return o(d)},style:{width:"100%"}},s))}),q+"Select",function(t){var i=t.value,o=t.onChange,s=t.options,l=s===void 0?[]:s,d=Y()(t,Dt);return L.createElement(ve.default,f()({value:i,onChange:function(h){return o(h)},style:{width:"100%"}},d),(l||[]).map(function(p){return L.createElement(ve.default.Option,{key:p.value,value:p.value},p.label)}))}),q+"Checkbox",function(t){var i=t.value,o=t.onChange,s=Y()(t,Tt);return L.createElement(He.Z,f()({checked:!!i,onChange:function(d){return o(d.target.checked)}},s))}),q+"Checkbox.Group",function(t){var i=t.value,o=t.onChange,s=t.options,l=s===void 0?[]:s,d=Y()(t,At);return L.createElement(He.Z.Group,f()({value:i,onChange:function(h){return o(h)},options:l},d))}),q+"Radio.Group",function(t){var i=t.value,o=t.onChange,s=t.options,l=s===void 0?[]:s,d=Y()(t,Pt);return L.createElement(Ve.ZP.Group,f()({value:i,onChange:function(h){return o(h.target.value)}},d),(l||[]).map(function(p){return L.createElement(Ve.ZP,{key:p.value,value:p.value},p.label)}))}),q+"Switch",function(t){var i=t.value,o=t.onChange,s=Y()(t,rt);return L.createElement(Nt.Z,f()({checked:!!i,onChange:function(d){return o(d)}},s))}),j()(j()(j()(j()(j()(j()(j()(j()(j()(j()(Be,q+"DatePicker",function(t){var i=t.value,o=t.onChange,s=Y()(t,at);return L.createElement(Je.default,f()({value:i,onChange:function(d){return o(d)},style:{width:"100%"}},s))}),q+"DatePicker.RangePicker",function(t){var i=t.value,o=t.onChange,s=Y()(t,Mt);return L.createElement(Je.default.RangePicker,f()({value:i,onChange:function(d){return o(d)},style:{width:"100%"}},s))}),q+"TimePicker",function(t){var i=t.value,o=t.onChange,s=Y()(t,Bt);return L.createElement(yt.Z,f()({value:i,onChange:function(d){return o(d)},style:{width:"100%"}},s))}),q+"Slider",function(t){var i=t.value,o=t.onChange,s=Y()(t,Ot);return L.createElement(Et.Z,f()({value:i,onChange:function(d){return o(d)}},s))}),q+"Cascader",function(t){var i=t.value,o=t.onChange,s=t.options,l=s===void 0?[]:s,d=Y()(t,Lt);return L.createElement(Qe.Z,f()({value:i,onChange:function(h){return o(h)},options:l},d))}),q+"TreeSelect",function(t){var i=t.value,o=t.onChange,s=Y()(t,ut);return L.createElement(qe.Z,f()({value:i,onChange:function(d){return o(d)},treeDefaultExpandAll:!0,style:{width:"100%"}},s))}),q+"Rate",function(t){var i=t.value,o=t.onChange,s=Y()(t,it);return L.createElement(Ct.Z,f()({value:i,onChange:function(d){return o(d)}},s))}),q+"AutoComplete",function(t){var i=t.value,o=t.onChange,s=t.options,l=s===void 0?[]:s,d=Y()(t,Rt);return L.createElement(bt.Z,f()({value:i,onChange:function(h){return o(h)},options:l,style:{width:"100%"}},d))}),q+"Mentions",function(t){var i=t.value,o=t.onChange,s=Y()(t,xt);return L.createElement(Ft.Z,f()({value:i,onChange:function(d){return o(d)}},s))}),q+"Upload",function(t){var i=t.value,o=t.onChange,s=Y()(t,$t);return L.createElement(wt.Z,f()({fileList:i,onChange:function(d){var p=d.fileList;return o(p)}},s))}),j()(j()(Be,q+"Transfer",function(t){var i=t.value,o=t.onChange,s=t.dataSource,l=s===void 0?[]:s,d=Y()(t,jt);return L.createElement(_e.Z,f()({targetKeys:i,onChange:function(h){return o(h)},dataSource:l},d))}),q+"ColorPicker",function(t){var i=t.value,o=t.onChange,s=Y()(t,st);return L.createElement(et.Z,f()({value:i,onChange:function(d){var p;return o((d==null||(p=d.toHexString)===null||p===void 0?void 0:p.call(d))||d)}},s))})),Gt=Ut,Ht=E(76711),Te=E.n(Ht),Oe=E(76653),ot=E(44592),T=E(31549),Vt=function(i){var o=i.value,s=i.onChange,l=Array.isArray(o)?o:[],d=function(F,C){var G=l.map(function(H,R){return R===F?f()(f()({},H),{},{key:C}):H});s(G)},p=function(F,C){var G=l.map(function(H,R){return R===F?f()(f()({},H),{},{value:C}):H});s(G)},h=function(){s([].concat(Te()(l),[{key:"",value:""}]))},y=function(F){var C=l.filter(function(G,H){return H!==F});s(C)},m=l.map(function(M){return(M.key||"").trim()}),b=m.reduce(function(M,F){return F&&(M[F]=(M[F]||0)+1),M},{}),A=new Set(Object.keys(b).filter(function(M){return b[M]>1})),w=m.some(function(M){return!M}),D=function(F){var C=(F||"").trim();return!!(!C||A.has(C))};return(0,T.jsx)("div",{style:{marginTop:8},children:(0,T.jsxs)(Q.Z,{direction:"vertical",style:{width:"100%"},size:8,children:[l.map(function(M,F){return(0,T.jsxs)("div",{style:{display:"flex",gap:8,width:"100%"},children:[(0,T.jsx)(z.Z,{placeholder:"\u952E\uFF08\u5FC5\u586B\u4E14\u552F\u4E00\uFF09",allowClear:!0,size:"small",value:M.key,status:D(M.key)?"error":void 0,onChange:function(G){return d(F,G.target.value)},style:{flex:"1 1 0"}}),(0,T.jsx)(z.Z,{placeholder:"\u503C",allowClear:!0,size:"small",value:M.value,onChange:function(G){return p(F,G.target.value)},style:{flex:"1 1 0"}}),(0,T.jsx)(ke.ZP,{type:"text",danger:!0,size:"small",icon:(0,T.jsx)(Oe.Z,{}),onClick:function(){return y(F)},style:{minWidth:0,width:24,height:24,padding:0},"aria-label":"\u79FB\u9664\u4E00\u9879"})]},F)}),(0,T.jsx)(ke.ZP,{type:"dashed",size:"small",onClick:h,icon:(0,T.jsx)(ot.Z,{}),children:"\u6DFB\u52A0\u53C2\u6570"}),(w||A.size>0)&&(0,T.jsxs)("div",{style:{color:"#ff4d4f",fontSize:12},children:["\u952E\u5FC5\u586B\u4E14\u552F\u4E00\uFF1A",w&&(0,T.jsx)("span",{children:"\u5B58\u5728\u7A7A\u952E\uFF1B"}),A.size>0&&(0,T.jsxs)("span",{children:["\u91CD\u590D\u952E\uFF1A",Array.from(A).join(", ")]})]})]})})},on=Vt,Wt={"key-value-editor":on},ye=Wt,Zt=f()(f()({},Gt),ye),k=["value","onChange"],lt=function(){function t(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Xe()(this,t),j()(this,"nodeSchemas",{}),j()(this,"widgets",{}),j()(this,"subscribers",[]),this.nodeSchemas=f()({},i),this.widgets=f()(f()({},Zt),o)}return Ye()(t,[{key:"notifySubscribers",value:function(){this.subscribers.forEach(function(o){return o()})}},{key:"injectNodeSchema",value:function(o,s){this.nodeSchemas[o]=s,this.notifySubscribers()}},{key:"injectWidget",value:function(o,s){this.widgets[o]=s,this.notifySubscribers()}},{key:"getNodeSchemas",value:function(){return f()({},this.nodeSchemas)}},{key:"getWidgets",value:function(){return f()({},this.widgets)}},{key:"subscribe",value:function(o){var s=this;return this.subscribers.push(o),function(){s.subscribers=s.subscribers.filter(function(l){return l!==o})}}}]),t}(),Ae=null,ln=new Set;function zt(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ae||(Ae=new lt(t,i)),Ae}function Pe(){return Ae||zt(),Ae}function Le(t,i){Pe().injectNodeSchema(t,i)}function Ie(t,i){Pe().injectWidget(t,i)}function We(){return Pe().getNodeSchemas()}function Ce(){return Pe().getWidgets()}function ct(t,i){var o=Pe().getWidgets(),s=i||t,l=[s].filter(Boolean),d=mt()(l),p;try{for(d.s();!(p=d.n()).done;){var h=p.value;if(o[h])return o[h]}}catch(A){d.e(A)}finally{d.f()}var y=l[0]||s;if(0)var m;if(o.ant_Input)return o.ant_Input;var b=function(w){var D=w||{},M=D.value,F=D.onChange,C=Y()(D,k);return L.createElement(z.Z,f()({value:M,onChange:function(H){var R;return F&&F(H==null||(R=H.target)===null||R===void 0?void 0:R.value)}},C))};return b}var ie=function(i,o){if(!i.dependsOn)return!0;var s=i.dependsOn,l=s.field,d=s.value,p=o[l];return typeof d=="function"?d(p):p===d},Ze=(0,L.forwardRef)(function(t,i){var o=t.schema,s=t.value,l=t.onChange,d=t.onSave,p=t.onValidateSave,h=t.showButtons,y=h===void 0?!0:h,m=t.renderButton,b=I.Z.useForm(),A=Z()(b,1),w=A[0];(0,L.useImperativeHandle)(i,function(){return{form:w}},[w]);var D=(0,L.useState)(s||{}),M=Z()(D,2),F=M[0],C=M[1];(0,L.useEffect)(function(){if(s&&Object.keys(s).length>0)w.setFieldsValue(s),C(s);else{var x={};o.config.forEach(function(V){V.defaultValue!==void 0&&(x[V.field]=V.defaultValue)}),w.setFieldsValue(x),C(x)}},[s,o,w]);var G=function(){var V=w.getFieldsValue();d==null||d(V)},H=function(){var x=$()(O()().mark(function V(){var B;return O()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.prev=0,U.next=3,w.validateFields();case 3:B=U.sent,pe.ZP.success("\u6821\u9A8C\u901A\u8FC7"),p==null||p(B),U.next=11;break;case 8:U.prev=8,U.t0=U.catch(0),pe.ZP.error("\u6821\u9A8C\u5931\u8D25, \u8BF7\u68C0\u67E5\u8868\u5355\u8F93\u5165\u9879");case 11:case"end":return U.stop()}},V,null,[[0,8]])}));return function(){return x.apply(this,arguments)}}(),R=function(){return(0,T.jsx)(I.Z.Item,{children:m==null?void 0:m()})};return(0,T.jsxs)(I.Z,{layout:"vertical",style:{width:"100%"},form:w,onValuesChange:function(V,B){C(B),l==null||l(B)},children:[o.config.map(function(x){var V=ct(x.type,x.widget),B=ie(x,F||{});if(!B)return null;var X=x.formItemProps,U=X===void 0?{}:X,re=x.widgetProps,ae=re===void 0?{}:re;return(0,T.jsx)(I.Z.Item,f()(f()({name:x.field,label:x.label},U),{},{children:(0,T.jsx)(V,f()({},ae))}),x.field)}),m?R():y&&(0,T.jsx)(I.Z.Item,{children:(0,T.jsxs)(Q.Z,{children:[(0,T.jsx)(ke.ZP,{type:"primary",onClick:H,children:"\u6821\u9A8C\u5E76\u4FDD\u5B58\u914D\u7F6E"}),(0,T.jsx)(ke.ZP,{type:"primary",onClick:G,children:"\u4FDD\u5B58\u914D\u7F6E"})]})})]})}),dt=Ze;function Cn(t,i){injectWidget(t,i)}function cn(t,i){Le(t,i)}function dn(t,i){i!=null&&i.schema&&Le(String(t),i.schema),i!=null&&i.widgets&&Object.entries(i.widgets).forEach(function(o){var s=Z()(o,2),l=s[0],d=s[1];Ie(l,d)})}function Kt(t){var i=t.getAllPlugins(),o=We();i.forEach(function(s){var l,d=(l=s.getNodeFormConfig)===null||l===void 0?void 0:l.call(s);if(d){var p=String(s.pluginNodeType);!o[p]&&d.schema&&Le(p,d.schema),d.widgets&&Object.entries(d.widgets).forEach(function(h){var y=Z()(h,2),m=y[0],b=y[1];Ie(m,b)})}})}function vt(t,i){var o,s=We(),l=s[i],d=t.getPlugin(i),p=(o=d.getNodeFormConfig)===null||o===void 0?void 0:o.call(d);return p!=null&&p.widgets&&Object.entries(p.widgets).forEach(function(h){var y=Z()(h,2),m=y[0],b=y[1];Ie(m,b)}),l?p!=null&&p.widgets?{schema:l,widgets:p.widgets}:{schema:l}:p}var Xt=E(14849),se=E(16211),vn=E(62853),gt=E(99932),ee=E(71915),ne=E(59820),be=Ye()(function t(i){var o=this;Xe()(this,t),j()(this,"getNodes",void 0),j()(this,"setNodes",void 0),j()(this,"getEdges",void 0),j()(this,"setEdges",void 0),j()(this,"getLabelByType",void 0),j()(this,"openConfigDrawer",void 0),j()(this,"decorateNodes",function(s,l){return s.map(function(d){return f()(f()({},d),{},{data:f()(f()({},d.data),{},{onAddNode:function(h){return l(d.id,h)}})})})}),j()(this,"decorateEdges",function(s,l){return s.map(function(d){return f()(f()({},d),{},{data:f()(f()({},d.data),{},{onAddNode:function(h){return l(d.id,h)}})})})}),j()(this,"addNodeAfter",function(s,l){var d,p,h,y,m,b=o.getNodes(),A=b.find(function(x){return x.id===s});if(A){var w=(d=(p=A.position)===null||p===void 0?void 0:p.x)!==null&&d!==void 0?d:0,D=(h=(y=A.position)===null||y===void 0?void 0:y.y)!==null&&h!==void 0?h:0,M={x:w+200,y:D},F=o.getLabelByType?o.getLabelByType(l):l,C="n_".concat(Date.now()),G={id:C,type:"basic_node",position:M,data:f()(f()({},A.data),{},{label:F,name:F,pluginNodeType:l})},H="e_".concat(Date.now(),"_insert"),R={id:H,type:"basic_edge",source:s,target:C};o.setEdges(function(x){return[].concat(Te()(x.map(function(V){return V.source===s?f()(f()({},V),{},{source:C}):V})),[R])}),o.setNodes(function(x){return[].concat(Te()(x),[G])}),(m=o.openConfigDrawer)===null||m===void 0||m.call(o,G)}}),j()(this,"insertNodeOnEdge",function(s,l){var d,p,h,y,m,b,A,w,D,M=o.getNodes(),F=o.getEdges(),C=F.find(function(S){return S.id===s});if(C){var G=M.find(function(S){return S.id===C.source}),H=M.find(function(S){return S.id===C.target}),R=(d=G==null||(p=G.position)===null||p===void 0?void 0:p.x)!==null&&d!==void 0?d:0,x=(h=G==null||(y=G.position)===null||y===void 0?void 0:y.y)!==null&&h!==void 0?h:0,V=(m=H==null||(b=H.position)===null||b===void 0?void 0:b.x)!==null&&m!==void 0?m:R+200,B=(A=H==null||(w=H.position)===null||w===void 0?void 0:w.y)!==null&&A!==void 0?A:x,X={x:(R+V)/2,y:(x+B)/2},U=o.getLabelByType?o.getLabelByType(l):l,re="n_".concat(Date.now()),ae={id:re,type:"basic_node",position:X,data:{label:U,name:U,pluginNodeType:l}},oe={id:"e_".concat(Date.now(),"_a"),type:"basic_edge",source:C.source,target:re},Ke={id:"e_".concat(Date.now(),"_b"),type:"basic_edge",source:re,target:C.target};o.setNodes(function(S){return[].concat(Te()(S),[ae])}),o.setEdges(function(S){return[].concat(Te()(S.filter(function(ge){return ge.id!==s})),[oe,Ke])}),(D=o.openConfigDrawer)===null||D===void 0||D.call(o,ae)}}),j()(this,"deleteNode",function(s){o.setNodes(function(l){return l.filter(function(d){return d.id!==s})}),o.setEdges(function(l){return l.filter(function(d){return d.source!==s&&d.target!==s})})}),j()(this,"updateNode",function(s,l){o.setNodes(function(d){return d.map(function(p){return p.id===s?f()(f()(f()({},p),l),{},{data:f()(f()({},p.data),l.data)}):p})})}),this.getNodes=i.getNodes,this.setNodes=i.setNodes,this.getEdges=i.getEdges,this.setEdges=i.setEdges,this.getLabelByType=i.getLabelByType,this.openConfigDrawer=i.openConfigDrawer}),Re=E(89245),xe=E(27107),Yt=function(i){var o=i.onItemClick,s=(0,ne.PluginManagerInstance)(),l=s.getAllPluginNodeTypes();return(0,T.jsx)("div",{style:{minWidth:160},children:l.map(function(d){return(0,T.jsx)("div",{onClick:function(){return o(d.value)},style:{padding:"6px 8px",cursor:"pointer"},children:d.label},d.value)})})},$e=Yt,Jt=function(){return document.getElementById("flow-box")||document.body},Qt=function(i){var o=i.onAddNode,s=i.placement,l=s===void 0?"right":s,d=i.getPopupContainer,p=i.className,h=(0,L.useState)(!1),y=Z()(h,2),m=y[0],b=y[1],A=function(D){o(D),b(!1)};return(0,T.jsx)(xe.Z,{trigger:"click",content:(0,T.jsx)($e,{onItemClick:A}),open:m,onOpenChange:function(D){b(D)},style:{padding:0},placement:l,arrow:!1,zIndex:1e4,getPopupContainer:d!=null?d:Jt,children:(0,T.jsx)("span",{className:["handle-plus",p].filter(Boolean).join(" "),title:"\u6DFB\u52A0\u8282\u70B9","aria-label":"\u6DFB\u52A0\u8282\u70B9",onClick:function(D){D.stopPropagation()},children:"+"})})},ze=(0,L.memo)(Qt),gn=["id","selected"],qt=function(i){var o=i.id,s=i.selected,l=Y()(i,gn),d=(0,Re.OQ)(l),p=Z()(d,3),h=p[0],y=p[1],m=p[2];return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(se.u5,{id:o,path:h,markerEnd:l.markerEnd}),(0,T.jsx)(se.XQ,{children:s&&(0,T.jsx)("div",{className:"nodrag nopan",style:{transform:"translate(-50%, -50%) translate(".concat(y,"px,").concat(m,"px)"),pointerEvents:"all"},onClick:function(A){A.stopPropagation()},children:(0,T.jsx)(ze,{onAddNode:function(A){var w,D;(w=l.data)===null||w===void 0||(D=w.onAddNode)===null||D===void 0||D.call(w,A)},getPopupContainer:function(){return document.getElementById("flow-box")||document.body}})})})]})},N=(0,L.memo)(qt),v={basic_edge:N},e=v,r=function(i){var o,s=i.data,l=i.isConnectable;return console.log(s),(0,T.jsxs)("div",{className:"custom-node",children:[s.pluginNodeType!=="Trigger"&&(0,T.jsx)(se.HH,{type:"target",position:Re.Ly.Left,isConnectable:l,className:"custom-node-handle custom-node-handle-target"}),(0,T.jsx)("div",{children:(o=s.label)!==null&&o!==void 0?o:s.name}),(s==null?void 0:s.pluginNodeType)!=="End"&&(0,T.jsx)(se.HH,{type:"source",position:Re.Ly.Right,isConnectable:l,className:"custom-node-handle custom-node-handle-source",onClick:function(p){p.stopPropagation()},children:(0,T.jsx)(ze,{onAddNode:function(p){var h,y;s==null||(h=(y=s).onAddNode)===null||h===void 0||h.call(y,p)},getPopupContainer:function(){return document.getElementById("flow-box")||document.body}})})]})},n=L.memo(r),u={basic_node:n},a=u,c=function(i){var o,s,l,d,p,h,y,m=i.data,b=i.initialValue,A=i.onNodeConfigChange,w=i.isValidate,D=w===void 0?!0:w,M=(0,ne.PluginManagerInstance)(),F=M.getAllPluginNodeTypes();console.log(F);var C=(0,L.useState)(!1),G=Z()(C,2),H=G[0],R=G[1],x=(0,L.useState)(null),V=Z()(x,2),B=V[0],X=V[1],U=(0,L.useState)(null),re=Z()(U,2),ae=re[0],oe=re[1],Ke=(0,L.useState)({}),S=Z()(Ke,2),ge=S[0],je=S[1],bn=(0,L.useState)({}),fn=Z()(bn,2),_t=fn[0],hn=fn[1],Fn=(0,L.useState)(!1),pn=Z()(Fn,2),wn=pn[0],en=pn[1],mn=(0,L.useRef)(null),kn=(0,se.Rr)((o=m==null?void 0:m.nodes)!==null&&o!==void 0?o:[]),tn=Z()(kn,3),nn=tn[0],Nn=tn[1],In=tn[2],Sn=(0,se.ll)((s=m==null?void 0:m.edges)!==null&&s!==void 0?s:[]),rn=Z()(Sn,3),an=rn[0],yn=rn[1],Dn=rn[2];function En(K){try{var W,J,_,ue,fe=vt(M,(W=K.data)===null||W===void 0?void 0:W.pluginNodeType);if(!fe){pe.ZP.warning("\u8282\u70B9 ".concat(K.id," \u6682\u65E0\u914D\u7F6E\u8868\u5355"));return}X(K),oe(fe.schema);var Me={};(J=fe.schema.config)===null||J===void 0||J.forEach(function(he){(he==null?void 0:he.defaultValue)!==void 0&&(Me[he.field]=he.defaultValue)});var Fe=(_=_t[K.id])!==null&&_!==void 0?_:f()(f()({},Me),(ue=b==null?void 0:b[K.id])!==null&&ue!==void 0?ue:{});je(Fe),R(!0)}catch(he){console.error(he),pe.ZP.error("\u52A0\u8F7D\u8282\u70B9\u914D\u7F6E\u5931\u8D25")}}var ft=L.useMemo(function(){return new be({getNodes:function(){return nn},setNodes:Nn,getEdges:function(){return an},setEdges:yn,getLabelByType:function(W){var J,_=M.getAllPluginNodeTypes(),ue=_.find(function(fe){return fe.value===W});return(J=ue==null?void 0:ue.label)!==null&&J!==void 0?J:W},openConfigDrawer:En})},[nn,an]);(0,L.useEffect)(function(){var K,W;Nn((K=m==null?void 0:m.nodes)!==null&&K!==void 0?K:[]),yn((W=m==null?void 0:m.edges)!==null&&W!==void 0?W:[])},[m==null?void 0:m.nodes,m==null?void 0:m.edges]),(0,L.useEffect)(function(){Kt(M)},[]),(0,L.useEffect)(function(){if(!(!(m!=null&&m.nodes)||m.nodes.length===0))try{var K={};m.nodes.forEach(function(W){var J,_,ue,fe=W.id,Me=(J=W.data)===null||J===void 0?void 0:J.pluginNodeType,Fe=vt(M,Me),he={};Fe!=null&&(_=Fe.schema)!==null&&_!==void 0&&_.config&&Fe.schema.config.forEach(function(Se){(Se==null?void 0:Se.defaultValue)!==void 0&&(he[Se.field]=Se.defaultValue)});var we=(ue=b==null?void 0:b[fe])!==null&&ue!==void 0?ue:{};K[fe]=f()(f()({},he),we)}),hn(function(W){var J={};return Object.keys(K).forEach(function(_){J[_]=K[_]}),Object.keys(W).forEach(function(_){J[_]=f()(f()({},K[_]),W[_])}),J})}catch(W){console.warn("\u521D\u59CB\u5316\u9ED8\u8BA4\u914D\u7F6E\u5931\u8D25",W)}},[m==null?void 0:m.nodes,b]);var un=function(W,J){hn(function(_){return f()(f()({},_),{},j()({},W,J))}),A==null||A(W,J)},Tn=function(W){je(W)},An=function(W){B!=null&&B.id&&(un(B.id,W),pe.ZP.success("\u5DF2\u4FDD\u5B58\u5F53\u524D\u8282\u70B9\u914D\u7F6E"))},Pn=function(W){B!=null&&B.id&&(un(B.id,W),pe.ZP.success("\u6821\u9A8C\u901A\u8FC7\u5E76\u5DF2\u4FDD\u5B58"),R(!1))},Mn=function(){var K=$()(O()().mark(function W(){var J,_,ue,fe,Me,Fe;return O()().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:if(ue=(J=mn.current)===null||J===void 0?void 0:J.form,!(!ue||!(B!=null&&B.id))){we.next=4;break}return R(!1),we.abrupt("return");case 4:if(fe=ue.getFieldsValue(),Me=(_=_t[B.id])!==null&&_!==void 0?_:{},Fe=JSON.stringify(Me)===JSON.stringify(fe),!Fe){we.next=10;break}return R(!1),we.abrupt("return");case 10:gt.Z.confirm({title:"\u662F\u5426\u4FDD\u5B58\u5F53\u524D\u914D\u7F6E\uFF1F",content:D?"\u4FDD\u5B58\u524D\u5C06\u8FDB\u884C\u6821\u9A8C\u3002":"\u4E0D\u6821\u9A8C\uFF0C\u76F4\u63A5\u4FDD\u5B58\u5F53\u524D\u503C\u3002",okText:"\u4FDD\u5B58\u5E76\u5173\u95ED",cancelText:"\u4E0D\u4FDD\u5B58\u5173\u95ED",onOk:function(){var Se=$()(O()().mark(function Ln(){var sn;return O()().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:if(le.prev=0,!D){le.next=7;break}return le.next=4,ue.validateFields();case 4:sn=le.sent,le.next=8;break;case 7:sn=ue.getFieldsValue();case 8:un(B.id,sn),R(!1),pe.ZP.success(D?"\u6821\u9A8C\u901A\u8FC7\u5E76\u5DF2\u4FDD\u5B58":"\u5DF2\u4FDD\u5B58\u5F53\u524D\u8282\u70B9\u914D\u7F6E"),le.next=16;break;case 13:le.prev=13,le.t0=le.catch(0),pe.ZP.error("\u6821\u9A8C\u5931\u8D25, \u8BF7\u68C0\u67E5\u8868\u5355\u8F93\u5165\u9879");case 16:case"end":return le.stop()}},Ln,null,[[0,13]])}));function On(){return Se.apply(this,arguments)}return On}(),onCancel:function(){R(!1)}});case 11:case"end":return we.stop()}},W)}));return function(){return K.apply(this,arguments)}}(),Bn=function(){en(!0)};return(0,T.jsxs)("div",{style:{width:"100%",height:"100vh",position:"relative",overflow:"hidden"},id:"flow-box",children:[(0,T.jsx)(Q.Z,{style:{padding:8},children:(0,T.jsx)(ke.ZP,{type:"primary",onClick:Bn,children:"\u4FDD\u5B58\u6D41\u7A0B"})}),(0,T.jsx)("div",{style:{height:"calc(100vh - 64px)"},children:(0,T.jsxs)(se.x$,{nodes:ft.decorateNodes(nn,ft.addNodeAfter),edges:ft.decorateEdges(an,ft.insertNodeOnEdge),nodeTypes:a,edgeTypes:e,fitView:!0,selectionKeyCode:null,minZoom:.5,onNodesChange:In,onEdgesChange:Dn,onNodeClick:function(W,J){En(J)},isValidConnection:function(W){var J=W.target,_=W.source;return J!==_},children:[(0,T.jsx)(se.Aq,{color:"#ccc",gap:8,size:1,variant:se.T7.Dots}),(0,T.jsx)(se.a9,{style:{backgroundColor:"#f8fafc",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},pannable:!0,zoomable:!0,ariaLabel:"\u5C0F\u5730\u56FE"}),(0,T.jsx)(se.ZX,{})]})}),(0,T.jsx)(ee.Z,{open:H,onClose:Mn,width:420,title:B?"".concat((l=(d=(p=B.data)===null||p===void 0?void 0:p.label)!==null&&d!==void 0?d:(h=B.data)===null||h===void 0?void 0:h.name)!==null&&l!==void 0?l:"","\uFF08").concat(B==null||(y=B.data)===null||y===void 0?void 0:y.pluginNodeType,"\uFF09"):"\u8282\u70B9\u914D\u7F6E",rootStyle:{position:"absolute",zIndex:9},getContainer:function(){return document.getElementById("flow-box")||document.body},destroyOnHidden:!0,children:ae?(0,T.jsx)(dt,{ref:mn,schema:ae,value:ge,isValidate:D,showButtons:!1,onChange:Tn,onSave:An,onValidateSave:Pn},B==null?void 0:B.id):(0,T.jsx)("div",{children:"\u8BE5\u8282\u70B9\u6682\u4E0D\u652F\u6301\u914D\u7F6E"})}),(0,T.jsx)(gt.Z,{open:wn,onCancel:function(){return en(!1)},footer:[(0,T.jsx)(ke.ZP,{onClick:function(){return en(!1)},children:"\u5173\u95ED"},"close")],title:"\u6D41\u7A0B\u914D\u7F6E",width:600,children:(0,T.jsx)("pre",{style:{maxHeight:360,overflow:"auto",margin:0},children:JSON.stringify(_t,null,2)})})]})},g=c}}]);
